---
title: 微服务与SpringCloud
date: 2023-03-25 11:22:21
permalink: /pages/58a1d3/
categories:
  - 后端
  - SpringCloud
tags:
  - 
author: 
  name: MYH
  link: https://github.com/mengyahui
---


## 1-什么是微服务？

微服务架构（Microservice Architecture）是一种架构理念，业界没有严格统一的定义，但是作为**微服务**这名词的发明人，Martin Fowler 对微服务的定义似乎更具有权威性和指导意义：

>简而言之，微服务架构的风格，就是将单一程序开发成一个个微服务， 每个微服务运行在自己的进程中，并使用轻量级通信机制，通常是 HTTP RESTFUL API 。这些服务围绕业务能力来划分构建的，并通 过完全自动化部署机制来独立部署这些服务可以使用不同的编程语 言，以及不同数据存储技术，以保证最低限度的集中式管理。

## 2-微服务需要解决的问题

微服务架构风格是将单个应用程序开发为一套套小型服务，每个服务运行在自己的进程中，并通过轻量级通信机制进行通信。这些**服务围绕业务功能构建**，并通过全自动部署机制独立部署。同时做到对这些服务进行集中式的管理，但不同的服务可能是用不同的编程语言编写的，并使用不同的数据存储技术。

如果说要构建一套符合微服务架构理念的系统，可能需要解决如下的问题：

- 众多的服务，如何统一且有效地进行管理？
- 如何解决各个服务之间的通信？
- 如此多的服务，客户端如何访问？
- 当出现了问题，如何再众多的服务中进行排查和处理？

## 3-微服务架构的相关概念

下面是微服务架构针对需要解决的问题提出的一些相关概念。

#### 3.1 服务治理

服务治理就是通过注册中心进行服务的自动化管理，其核心是服务的注册与发现。其中服务实例将自身服务信息注册到注册中心就叫做服务注册，而服务实例通过注册中心获取到其中的实例的服务信息，并通过这些信息去请求相关服务的过程就是服务发现。此外，注册中心还应该具备剔除出现问题的服务的功能。

#### 3.2 服务调用

再在微服务架构中，通常存在多个服务之间的远程调用需求。目前主流的远程调用技术有基于 HTTP 请求的 RESTFul接口及基于 TCP 的 RPC 协议。

- REST(Representational State Transfer)：这是一种 HTTP 调用的格式，更标准，更通用，无论哪种语言都支持HTTP 协议。
- RPC（Remote Promote Call）：一种进程间通信方式。允许像调用本地服务一样调用远程服务。RPC 框架的主要目标就是让远程服务调用更简单、透明。RPC 框架负责屏蔽底层的传输方式、序列化方式和通信细节。开发人员在使用的时候只需要了解谁在什么位置提供了什么样的远程服务接口即可，并不需要关心底层通信细节和调用过程。

#### 3.3 服务网关

随着服务的不断增多，不同的服务一般会有不同的网络地址，而外部客户端可能需要调用多个服务的接口才能完成一个业务需求，如果让客户端直接与各个微服务通信可能会出现如下问题：

1. 客户端再不同的场景下需要调用不同的 URL 地址，为服务的调用增加了难度。
2. 在一定的场景下，可能会出现跨域请求的问题。
3. 每个服务都需要进行单独的身份认证。

为了解决这些问题，API 网关应运而生。一个网关的基本功能有：统一接入、安全防护、协议适配、流量管控、长短链接支持、容错能力。有了网关之后，各个 API 服务提供团队可以专注于自己的的业务逻辑处理，而 API 网关更专注于安全、流量、路由等问题。

#### 3.4 服务容错

在微服务架构中，一个请求通常会涉及到调用几个服务，如果其中某个服务不可用，没有做服务容错的话，极有可能会造成一连串的服务不可用，这就是雪崩效应。

虽然我们无法预防雪崩效应的发生，但我们应该尽可能地做好服务容错，服务容错的三个核心思想是：

1. 不被外界环境影响。
2. 不被上游请求压垮。
3. 不被下游请求拖垮。

#### 3.5 链路追踪

随着微服务架构的流行，服务按照不同的维度进行拆分，一次请求往往需要涉及到多个服务。互联网应用构建在不同的软件模块集上，这些软件模块，有可能是由不同的团队开发、可能使用不同的编程语言来实现、有可能布在了几千台服务器，横跨多个不同的数据中心。因此，就需要对一次请求涉及的多个服务链路进行日志记录。

所谓链路追踪，就是对一次请求涉及的很多个服务链路进行**日志记录**、**性能监控**。

## 4-SpringCloud

微服务仅仅是一种架构思想，而 SpringCloud 是微服务架构的一站式解决方案，基于 SpringBoot 风格的封装，屏蔽掉了复杂的配置和实现原理，最终给开发者留出了一套简单易懂、容易部署的分布式系统开发工具包。

SpringCloud 并没有重复造轮子，而是对现有的技术进行封装和维护，包括 spring-cloud-config、spring-cloud-bus 等近 20 个子项目，其中包含了服务注册与发现、配置中心、服务网关、智能路由、负载均衡、断路器、监控跟踪、分布式消息队列等解决方案。

SpringCloud 的组件以 Netflix 开源的组件为主，随着部分组件的停止维护，SpringCloud 也推出了一些替代的新组件，下图给出了 SpringCloud 的一些核心组件：

![1685883366667-3b848f38-7c99-4e45-9e9c-d8b39329b00f-16862783747342](https://cdn.jsdelivr.net/gh/mengyahui/image-repository@master/springcloud/1685883366667-3b848f38-7c99-4e45-9e9c-d8b39329b00f-16862783747342.6rp5qjzgkpc0.webp)

## 5-SpringCloud Alibaba

SpringCloud Alibaba 是阿里研发的一套微服务架构的落地技术方案，可以很好的兼容 SpringCloud。只需修改一些配置和注解，原生 SpringCloud 就可以接入到 SpringCloud Alibaba 中。此外，SpringCloud Alibaba 还提供了一些新组件，使得微服务架构有了更多的选择。

下面是 SpringCloud Alibaba 提供的核心开源组件：

- Sentinel：把流量作为切入点，从流量控制、熔断降级、系统负载保护等多个维度保护服务的稳定性。

- Nacos：一个更易于构建云原生应用的动态服务发现、配置管理和服务管理平台。

- RocketMQ：一款开源的分布式消息系统，基于高可用分布式集群技术，提供低延时的、高可靠的消息发布与订阅服务。

- Dubbo：Apache Dubbo 是一款高性能 Java RPC 框架。

- Seata：阿里巴巴开源产品，一个易于使用的高性能微服务分布式事务解决方案。

