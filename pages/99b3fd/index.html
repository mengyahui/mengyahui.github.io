<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>SpringBoot接入支付宝支付 | MYH&#39;s Blog</title>
    <meta name="generator" content="VuePress 1.9.5">
    <script src="https://cdn.jsdelivr.net/npm/react/umd/react.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/react-dom/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@babel/standalone/babel.min.js"></script>
    <link rel="icon" href="/img/favicon.ico">
    <meta name="description" content="web前端技术博客,专注web前端学习与总结。JavaScript,js,ES6,TypeScript,vue,React,python,css3,html5,Node,git,github等技术文章。">
    <meta name="keywords" content="博客,个人技术博客,后端,后端开发,后端框架,web前端,后端面试题,技术文档,学习,面试,Java,SpringBoot,MyBatis,MySQL,vue,Redis,SpringCloud,Nginx,MongoDB,git,Docker,markdown">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.042d882d.css" as="style"><link rel="preload" href="/assets/js/app.67223bcb.js" as="script"><link rel="preload" href="/assets/js/2.316bc55b.js" as="script"><link rel="preload" href="/assets/js/41.13dd3c48.js" as="script"><link rel="prefetch" href="/assets/js/10.a19925fb.js"><link rel="prefetch" href="/assets/js/11.526b83d6.js"><link rel="prefetch" href="/assets/js/12.5565edc8.js"><link rel="prefetch" href="/assets/js/13.3d6970aa.js"><link rel="prefetch" href="/assets/js/14.8eedc93a.js"><link rel="prefetch" href="/assets/js/15.d2da9468.js"><link rel="prefetch" href="/assets/js/16.c8ffcd7f.js"><link rel="prefetch" href="/assets/js/17.79b69729.js"><link rel="prefetch" href="/assets/js/18.55f1e803.js"><link rel="prefetch" href="/assets/js/19.f1227afb.js"><link rel="prefetch" href="/assets/js/20.e45349ee.js"><link rel="prefetch" href="/assets/js/21.1d53685b.js"><link rel="prefetch" href="/assets/js/22.59de4a41.js"><link rel="prefetch" href="/assets/js/23.35180819.js"><link rel="prefetch" href="/assets/js/24.8d404f24.js"><link rel="prefetch" href="/assets/js/25.3a005120.js"><link rel="prefetch" href="/assets/js/26.68cd2eea.js"><link rel="prefetch" href="/assets/js/27.39d3184a.js"><link rel="prefetch" href="/assets/js/28.39252e9a.js"><link rel="prefetch" href="/assets/js/29.8cfc649d.js"><link rel="prefetch" href="/assets/js/3.9a800561.js"><link rel="prefetch" href="/assets/js/30.8b9d3130.js"><link rel="prefetch" href="/assets/js/31.615bad2f.js"><link rel="prefetch" href="/assets/js/32.6ed3ef0f.js"><link rel="prefetch" href="/assets/js/33.66731721.js"><link rel="prefetch" href="/assets/js/34.1579207c.js"><link rel="prefetch" href="/assets/js/35.86ff114a.js"><link rel="prefetch" href="/assets/js/36.4aa49dd5.js"><link rel="prefetch" href="/assets/js/37.d6a0a8ea.js"><link rel="prefetch" href="/assets/js/38.cdd7fc8e.js"><link rel="prefetch" href="/assets/js/39.34a896dc.js"><link rel="prefetch" href="/assets/js/4.d1b60869.js"><link rel="prefetch" href="/assets/js/40.d3ba7ebb.js"><link rel="prefetch" href="/assets/js/42.44d4fbb4.js"><link rel="prefetch" href="/assets/js/43.0679497a.js"><link rel="prefetch" href="/assets/js/44.09c31938.js"><link rel="prefetch" href="/assets/js/45.40d49eef.js"><link rel="prefetch" href="/assets/js/46.3aa471f6.js"><link rel="prefetch" href="/assets/js/47.db96e5fd.js"><link rel="prefetch" href="/assets/js/48.5e0e4526.js"><link rel="prefetch" href="/assets/js/49.a3a85982.js"><link rel="prefetch" href="/assets/js/5.251bc32b.js"><link rel="prefetch" href="/assets/js/50.9ba01c48.js"><link rel="prefetch" href="/assets/js/51.dd99cdbc.js"><link rel="prefetch" href="/assets/js/52.6df8e45e.js"><link rel="prefetch" href="/assets/js/53.1e4cb3b8.js"><link rel="prefetch" href="/assets/js/54.3f0aee84.js"><link rel="prefetch" href="/assets/js/55.90b58b90.js"><link rel="prefetch" href="/assets/js/56.1ae97e41.js"><link rel="prefetch" href="/assets/js/57.4c7cbc1f.js"><link rel="prefetch" href="/assets/js/58.b60428fc.js"><link rel="prefetch" href="/assets/js/59.357d5e5e.js"><link rel="prefetch" href="/assets/js/6.559acfe3.js"><link rel="prefetch" href="/assets/js/7.74bb28c3.js"><link rel="prefetch" href="/assets/js/8.45d5678b.js"><link rel="prefetch" href="/assets/js/9.52b09d04.js">
    <link rel="stylesheet" href="/assets/css/0.styles.042d882d.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.png" alt="MYH's Blog" class="logo"> <span class="site-name can-hide">MYH's Blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><a href="/front-end/" class="link-title">前端</a> <span class="title" style="display:none;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/24a8e1/" class="nav-link">CSS</a></li><li class="dropdown-item"><!----> <a href="/pages/f4d72c/" class="nav-link">Vue</a></li><li class="dropdown-item"><!----> <a href="/pages/e44a21/" class="nav-link">JavaScript</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><a href="/back-end/" class="link-title">后端</a> <span class="title" style="display:none;">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/cd256c/" class="nav-link">SpringBoot</a></li><li class="dropdown-item"><!----> <a href="/pages/58a1d3/" class="nav-link">SpringCloud</a></li><li class="dropdown-item"><!----> <a href="/pages/b81f92/" class="nav-link">MyBatis</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><a href="/database/" class="link-title">数据库</a> <span class="title" style="display:none;">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/680c6f/" class="nav-link">elasticsearch</a></li><li class="dropdown-item"><!----> <a href="/pages/330887/" class="nav-link">mysql</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具" class="dropdown-title"><a href="/tools/" class="link-title">工具</a> <span class="title" style="display:none;">工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/01e90a/" class="nav-link">Git</a></li><li class="dropdown-item"><!----> <a href="/pages/f8ef21/" class="nav-link">Docker</a></li><li class="dropdown-item"><!----> <a href="/pages/3a7e1b/" class="nav-link">Nginx</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><a href="/more/" class="link-title">更多</a> <span class="title" style="display:none;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/f1db9f/" class="nav-link">学习</a></li><li class="dropdown-item"><!----> <a href="/pages/3c70e5/" class="nav-link">面试</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="/img/logo.png"> <div class="blogger-info"><h3>MYH</h3> <span>这家伙很懒，什么都没写......</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><a href="/front-end/" class="link-title">前端</a> <span class="title" style="display:none;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/24a8e1/" class="nav-link">CSS</a></li><li class="dropdown-item"><!----> <a href="/pages/f4d72c/" class="nav-link">Vue</a></li><li class="dropdown-item"><!----> <a href="/pages/e44a21/" class="nav-link">JavaScript</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><a href="/back-end/" class="link-title">后端</a> <span class="title" style="display:none;">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/cd256c/" class="nav-link">SpringBoot</a></li><li class="dropdown-item"><!----> <a href="/pages/58a1d3/" class="nav-link">SpringCloud</a></li><li class="dropdown-item"><!----> <a href="/pages/b81f92/" class="nav-link">MyBatis</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><a href="/database/" class="link-title">数据库</a> <span class="title" style="display:none;">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/680c6f/" class="nav-link">elasticsearch</a></li><li class="dropdown-item"><!----> <a href="/pages/330887/" class="nav-link">mysql</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具" class="dropdown-title"><a href="/tools/" class="link-title">工具</a> <span class="title" style="display:none;">工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/01e90a/" class="nav-link">Git</a></li><li class="dropdown-item"><!----> <a href="/pages/f8ef21/" class="nav-link">Docker</a></li><li class="dropdown-item"><!----> <a href="/pages/3a7e1b/" class="nav-link">Nginx</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><a href="/more/" class="link-title">更多</a> <span class="title" style="display:none;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/f1db9f/" class="nav-link">学习</a></li><li class="dropdown-item"><!----> <a href="/pages/3c70e5/" class="nav-link">面试</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>SpringBoot</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/cd256c/" class="sidebar-link">SpringBoot简介</a></li><li><a href="/pages/5cf0cf/" class="sidebar-link">创建SpringBoot项目与HelloWorld解析</a></li><li><a href="/pages/43b14b/" class="sidebar-link">SpringBoot配置文件</a></li><li><a href="/pages/3e3e97/" class="sidebar-link">SpringBoot读取配置</a></li><li><a href="/pages/3d8091/" class="sidebar-link">项目启动Banner配置</a></li><li><a href="/pages/e35581/" class="sidebar-link">默认日志管理与logback</a></li><li><a href="/pages/0fb413/" class="sidebar-link">Web开发：静态资源配置</a></li><li><a href="/pages/ca97de/" class="sidebar-link">Web开发：参数校验</a></li><li><a href="/pages/06bcb8/" class="sidebar-link">Web开发：异常处理</a></li><li><a href="/pages/9be92c/" class="sidebar-link">Web开发：CORS解决跨域</a></li><li><a href="/pages/0a1c8e/" class="sidebar-link">Web开发：定义系统启动任务</a></li><li><a href="/pages/d415df/" class="sidebar-link">Web开发：Swagger文档</a></li><li><a href="/pages/0d3c4b/" class="sidebar-link">Web开发：文件上传</a></li><li><a href="/pages/057f3e/" class="sidebar-link">SpringBoot整合SpringSecurity</a></li><li><a href="/pages/ad6b6d/" class="sidebar-link">SpringBoot整合验证码框架</a></li><li><a href="/pages/972103/" class="sidebar-link">SpringBoot根据IP解析地理位置信息</a></li><li><a href="/pages/f98bfa/" class="sidebar-link">SpringBoot创建二维码</a></li><li><a href="/pages/180eb2/" class="sidebar-link">SpringBoot动态定时任务</a></li><li><a href="/pages/99b3fd/" aria-current="page" class="active sidebar-link">SpringBoot接入支付宝支付</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/99b3fd/#一、开发环境准备" class="sidebar-link">一、开发环境准备</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/99b3fd/#_1-1-沙箱环境" class="sidebar-link">1.1 沙箱环境</a></li><li class="sidebar-sub-header level3"><a href="/pages/99b3fd/#_1-2-正式环境" class="sidebar-link">1.2 正式环境</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/99b3fd/#二、项目准备" class="sidebar-link">二、项目准备</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/99b3fd/#_2-1-导入坐标" class="sidebar-link">2.1 导入坐标</a></li><li class="sidebar-sub-header level3"><a href="/pages/99b3fd/#_2-2-配置证书-密钥" class="sidebar-link">2.2 配置证书/密钥</a></li><li class="sidebar-sub-header level3"><a href="/pages/99b3fd/#_2-3-创建支付客户端" class="sidebar-link">2.3 创建支付客户端</a></li><li class="sidebar-sub-header level3"><a href="/pages/99b3fd/#_2-4-创建业务接口" class="sidebar-link">2.4 创建业务接口</a></li><li class="sidebar-sub-header level4"><a href="/pages/99b3fd/#_2-4-1-支付业务接口" class="sidebar-link">2.4.1 支付业务接口</a></li><li class="sidebar-sub-header level4"><a href="/pages/99b3fd/#_2-4-2-通知业务接口" class="sidebar-link">2.4.2 通知业务接口</a></li><li class="sidebar-sub-header level4"><a href="/pages/99b3fd/#_2-4-3-退款业务接口" class="sidebar-link">2.4.3 退款业务接口</a></li><li class="sidebar-sub-header level4"><a href="/pages/99b3fd/#_2-4-4-转账业务接口" class="sidebar-link">2.4.4 转账业务接口</a></li><li class="sidebar-sub-header level3"><a href="/pages/99b3fd/#_2-5-创建请求接口" class="sidebar-link">2.5 创建请求接口</a></li><li class="sidebar-sub-header level4"><a href="/pages/99b3fd/#_2-5-1-支付请求接口" class="sidebar-link">2.5.1 支付请求接口</a></li><li class="sidebar-sub-header level4"><a href="/pages/99b3fd/#_2-5-2-通知请求接口" class="sidebar-link">2.5.2 通知请求接口</a></li><li class="sidebar-sub-header level4"><a href="/pages/99b3fd/#_2-5-3-退款请求接口" class="sidebar-link">2.5.3 退款请求接口</a></li><li class="sidebar-sub-header level4"><a href="/pages/99b3fd/#_2-5-4-转账请求接口" class="sidebar-link">2.5.4 转账请求接口</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/99b3fd/#三、支付接入" class="sidebar-link">三、支付接入</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/99b3fd/#_3-1-电脑网站支付" class="sidebar-link">3.1 电脑网站支付</a></li><li class="sidebar-sub-header level4"><a href="/pages/99b3fd/#_3-1-1-请求参数" class="sidebar-link">3.1.1 请求参数</a></li><li class="sidebar-sub-header level4"><a href="/pages/99b3fd/#_3-1-2-支付逻辑" class="sidebar-link">3.1.2 支付逻辑</a></li><li class="sidebar-sub-header level4"><a href="/pages/99b3fd/#_3-1-3-支付接口" class="sidebar-link">3.1.3 支付接口</a></li><li class="sidebar-sub-header level4"><a href="/pages/99b3fd/#_3-1-4-渲染表单" class="sidebar-link">3.1.4 渲染表单</a></li><li class="sidebar-sub-header level4"><a href="/pages/99b3fd/#_3-1-5-接口回调" class="sidebar-link">3.1.5 接口回调</a></li><li class="sidebar-sub-header level3"><a href="/pages/99b3fd/#_3-2-手机网站支付" class="sidebar-link">3.2 手机网站支付</a></li><li class="sidebar-sub-header level4"><a href="/pages/99b3fd/#_3-2-1-请求参数" class="sidebar-link">3.2.1 请求参数</a></li><li class="sidebar-sub-header level4"><a href="/pages/99b3fd/#_3-2-1-支付逻辑" class="sidebar-link">3.2 1 支付逻辑</a></li><li class="sidebar-sub-header level3"><a href="/pages/99b3fd/#_3-3-当面付-买家扫描商户二维码" class="sidebar-link">3.3 当面付（买家扫描商户二维码）</a></li><li class="sidebar-sub-header level4"><a href="/pages/99b3fd/#_3-3-1-请求参数" class="sidebar-link">3.3.1 请求参数</a></li><li class="sidebar-sub-header level4"><a href="/pages/99b3fd/#_3-3-2-支付逻辑" class="sidebar-link">3.3.2 支付逻辑</a></li><li class="sidebar-sub-header level3"><a href="/pages/99b3fd/#_3-4-支付结果查询" class="sidebar-link">3.4 支付结果查询</a></li><li class="sidebar-sub-header level4"><a href="/pages/99b3fd/#_3-4-1-请求参数" class="sidebar-link">3.4.1 请求参数</a></li><li class="sidebar-sub-header level4"><a href="/pages/99b3fd/#_3-4-2-业务逻辑" class="sidebar-link">3.4.2 业务逻辑</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/99b3fd/#四、退款接入" class="sidebar-link">四、退款接入</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/99b3fd/#_4-1-退款" class="sidebar-link">4.1 退款</a></li><li class="sidebar-sub-header level4"><a href="/pages/99b3fd/#_4-1-1-请求参数" class="sidebar-link">4.1.1 请求参数</a></li><li class="sidebar-sub-header level4"><a href="/pages/99b3fd/#_4-1-2-响应参数" class="sidebar-link">4.1.2 响应参数</a></li><li class="sidebar-sub-header level4"><a href="/pages/99b3fd/#_4-1-3-退款逻辑" class="sidebar-link">4.1.3 退款逻辑</a></li><li class="sidebar-sub-header level3"><a href="/pages/99b3fd/#_4-2-退款结果查询" class="sidebar-link">4.2 退款结果查询</a></li><li class="sidebar-sub-header level4"><a href="/pages/99b3fd/#_4-2-1-请求参数" class="sidebar-link">4.2.1 请求参数</a></li><li class="sidebar-sub-header level4"><a href="/pages/99b3fd/#_4-2-2-业务逻辑" class="sidebar-link">4.2.2 业务逻辑</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/99b3fd/#五、转账接入" class="sidebar-link">五、转账接入</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/99b3fd/#_5-1-查询支付宝账户资金" class="sidebar-link">5.1 查询支付宝账户资金</a></li><li class="sidebar-sub-header level4"><a href="/pages/99b3fd/#_5-1-1-请求参数" class="sidebar-link">5.1.1 请求参数</a></li><li class="sidebar-sub-header level4"><a href="/pages/99b3fd/#_5-1-2-响应参数" class="sidebar-link">5.1.2 响应参数</a></li><li class="sidebar-sub-header level4"><a href="/pages/99b3fd/#_5-1-2-业务逻辑" class="sidebar-link">5.1.2 业务逻辑</a></li><li class="sidebar-sub-header level3"><a href="/pages/99b3fd/#_5-2-查询转账业务单据" class="sidebar-link">5.2 查询转账业务单据</a></li><li class="sidebar-sub-header level4"><a href="/pages/99b3fd/#_5-2-1-请求参数" class="sidebar-link">5.2.1 请求参数</a></li><li class="sidebar-sub-header level4"><a href="/pages/99b3fd/#_5-2-2-响应参数" class="sidebar-link">5.2.2 响应参数</a></li><li class="sidebar-sub-header level4"><a href="/pages/99b3fd/#_5-2-3-业务逻辑" class="sidebar-link">5.2.3 业务逻辑</a></li><li class="sidebar-sub-header level3"><a href="/pages/99b3fd/#_5-3-转账" class="sidebar-link">5.3 转账</a></li><li class="sidebar-sub-header level4"><a href="/pages/99b3fd/#_5-3-1-请求参数" class="sidebar-link">5.3.1 请求参数</a></li><li class="sidebar-sub-header level4"><a href="/pages/99b3fd/#_5-3-2-响应参数" class="sidebar-link">5.3.2 响应参数</a></li><li class="sidebar-sub-header level4"><a href="/pages/99b3fd/#_5-3-3-业务逻辑" class="sidebar-link">5.3.3 业务逻辑</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/99b3fd/#六、下载对账单" class="sidebar-link">六、下载对账单</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/99b3fd/#_6-1-请求参数" class="sidebar-link">6.1 请求参数</a></li><li class="sidebar-sub-header level3"><a href="/pages/99b3fd/#_6-2-业务逻辑" class="sidebar-link">6.2 业务逻辑</a></li></ul></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>SpringCloud</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>MyBatis</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/back-end/#后端" data-v-06225672>后端</a></li><li data-v-06225672><a href="/back-end/#SpringBoot" data-v-06225672>SpringBoot</a></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://github.com/mengyahui" target="_blank" title="作者" class="beLink" data-v-06225672>MYH</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2023-06-10</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABH1JREFUSA3tVl1oHFUUPmdmd2ltklqbpJDiNnXFmgbFktho7YMPNiJSSZM0+CAYSkUELVhM6YuwIPpgoOKDqOBDC0XE2CQoNtQXBUFTTcCi+Wlh1V2TQExsUzcltd3M9Tt3ZjZzZ2fT+OJTL8yeM+eee757fmeJbq//KQL8X3DUSFOcfr7cRsRtxNQMWueeVzOkaITIGqQHNg5y8+jNW9ldM7A6nTpAjuolUikAwq7CE3WcM2RRDz+XGVgN3FptU/aUSlvq9Pa3iZ1+sgAqJyyAFqkipd9dqiwHF3P65YycLWc/6sqGrvoEoIp6DOFaX5h6+dnfjkWprwqsPk0dUGq5vySwDImC10KxFHgGL1SWoc92O3eVht09qdXNH11I2SsTsJYqMWzihqGMi+A+Garf3BAuuLI5oGlULyNfyB/HYNujwktOfRrMr5t77NmevqaUopx0grnKAyvVpmwUDB4x6FPXuGvYLTDwWsejwgtgkYKPqRJg8SV6xaiZ3ZTppGneS4yfH5/66fZSDHv+QZci/+h5c5UHtpy67JUqGppM0sh0Nc1dW6/N1W5Yoqat8/TU/VnadmdeW2PLLSyh0cvxBs3KbqTmwYPpxN4do/mzE8nEpvX/UMu2Wbp74zUAK5q6WkHns7V0eWkdPbPzd3rxkTGybadYySumVzhcaJFbs5UrEkQ/+CK8gF5dnh/6ciIZ73gwQ927L1IitoxKLXYP3SjYdOrHHfTZhRRlFyrorafPk20B3HPD1y2G3qKZME5Jcf3t/HUC13/8tSd++vqFveMUTwAUxSUFI1QekR1+bIze3D9MF2aq6cPvG72CgnldWCFqyRw3lwH8ZMerjTD9ElRO7Gv44wNpC90aASqGfVlz/Rx17srQ57/UU26hkhQqUB7dBR71WmzQhHUnblGmVOEw0jhbV1n9OlXUDCIRGaNV5Jp43N516fN7JmnTHdfp7Hgy0luO4aMhtkLL8Bi3bUWYvzh5Mn1dTxrL6QmGuRhGL/TiTTxRoEdTszSaq9GR0NGA3KdkOz3hqSV3MIDhQ5IVX/Ivx3umBti2es2h4eZby7x8br1rkf7Mo90AqC8aQ3sJeNzqFRu+vSANAQe3PL7l0HGOAdwDCeZYvNKeoZp1Qfs6Aipndh86HmFRi0LAnEO47wsqM6cdfjh3jBPUzhZy7nvlUfFsamED1VQt6aISHVymXZ/B2aCtIG8AI8xfobj2d3en1wWVhOeHELKmLQ1s211s88comkv4UCwWyF787mJdYXtNfhKAXVqnKTq8QZvGAGGOfaTo5pGZ/PwbUCr5+DPr/1J92JNHr9aOl/F3iI5+O1nfybsGxoimvZ3ViWSluDITw3P37mypheDIPY0tw7+O/5ApbkYw+zpfaUVu32Pi98+defdUhEpZkRFq0aqyNh9FuL9hpYbEm6iwi0z2REd09ZmyENEbuhjDWzKvZXTqKYaBIr3tt5kuPtQBZFvEUwHt60vfCNu41XsksH9Ij1BMMz1Y0OOunHNShFIP5868g5zeXmuLwL9T4b6Q2+KejgAAAABJRU5ErkJggg==">SpringBoot接入支付宝支付<!----></h1>  <div class="theme-vdoing-content content__default"><p>支付功能如今已经成为一个需要盈利的网站的基本功能了，通常都是选择接入第三方平台如支付宝、微信等。本文主要介绍了 SpringBoot 项目如何接入支付宝支付、转账以及退款等功能。</p> <h2 id="一、开发环境准备"><a href="#一、开发环境准备" class="header-anchor">#</a> 一、开发环境准备</h2> <p>开发接入支付宝在线支付功能，需要先在支付宝创建应用，并为这些应用添加相应的支付能力。但这些能力，是需要在支付宝商家中心进行签约的，一般都要求提交营业执照等信息，接入门槛比较高，对于开发者来说，可以使用支付宝提供可沙箱环境进行接入，后期也可以很方便的切换到正式环境。</p> <h3 id="_1-1-沙箱环境"><a href="#_1-1-沙箱环境" class="header-anchor">#</a> 1.1 沙箱环境</h3> <p><strong>① 进入沙箱环境</strong></p> <p>登录<a href="https://open.alipay.com/" target="_blank" rel="noopener noreferrer">支付宝开放平台<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>的控制台，在开发工具推荐选项下点击沙箱，即可进入沙箱环境。<em>默认的沙箱环境已经初始化了一个网页/移动应用和小程序</em>。</p> <p><img src="https://cdn.jsdelivr.net/gh/mengyahui/image-repository@master/springboot/image-20230518100541400.74wg0v47a1s0.jpg" alt="image-20230518100541400"></p> <p>这里我们只关注<em>网页/移动应用</em>，上图中的 APPID 作为应用的唯一标识，是接入在线支付功能需要用到的。</p> <p><strong>② 获取公钥/证书</strong></p> <p>支付接口涉及到资金的流转，必须要保证其安全性。支付宝通过对数据传输的接口进行加签来保证资金流转的安全性。</p> <p><img src="https://cdn.jsdelivr.net/gh/mengyahui/image-repository@master/springboot/image-20230518102034979.czthins6qlc.jpg" alt="image-20230518102034979"></p> <p>沙箱应用提供了系统默认密钥供开发者使用，分为公钥加签和证书加签两种模式。其中涉及到资金支出的接口必须使用证书加签模式。</p> <p>公钥模式：需要获取<em>应用私钥（Java语言）<em>和</em>支付宝公钥</em>两项。</p> <p>在证书模式：需要获取 <em>应用公钥证书</em>、<em>应用私钥（Java语言）</em>、<em>支付宝公钥证书</em>和<em>支付宝根证书</em>四项。</p> <p><strong>③ 获取沙箱账号</strong></p> <p>沙箱环境提供了默认的沙箱账号，分为买家账号和商家账号，若要使用买家账号向商家账号付款，则需要支付宝沙箱版本的客户端，仅提供了Android版本，下载地址：https://open.alipay.com/develop/sandbox/tool/alipayclint</p> <p><img src="https://cdn.jsdelivr.net/gh/mengyahui/image-repository@master/springboot/image-20230518105046663.wzvwovbk2f4.jpg" alt="image-20230518105046663"></p> <h3 id="_1-2-正式环境"><a href="#_1-2-正式环境" class="header-anchor">#</a> 1.2 正式环境</h3> <p>正式环境接入支付宝在线支付功能不同于沙箱环境，下图是手机网站支付的接入流程</p> <p><img src="https://yuque.antfin.com/images/lark/0/2022/jpeg/210044/1669294732057-74af7e26-aabc-4f9b-abbf-a440d2c23e30.jpeg?x-oss-process=image%2Fresize%2Cw_1554" alt="img"></p> <p>具体的接入流程可参考官方文档 https://opendocs.alipay.com/open/200/105310?pathHash=7f6d049a</p> <h2 id="二、项目准备"><a href="#二、项目准备" class="header-anchor">#</a> 二、项目准备</h2> <h3 id="_2-1-导入坐标"><a href="#_2-1-导入坐标" class="header-anchor">#</a> 2.1 导入坐标</h3> <p>在 SpringBoot 项目中导入支付宝提供的 sdk。</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alipay.sdk<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>alipay-sdk-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>4.35.132.ALL<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="_2-2-配置证书-密钥"><a href="#_2-2-配置证书-密钥" class="header-anchor">#</a> 2.2 配置证书/密钥</h3> <p>在 <code>application.yml</code> 配置文件中，配置如下信息：</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">alipay</span><span class="token punctuation">:</span>
  <span class="token key atrule">app-id</span><span class="token punctuation">:</span> <span class="token number">2021000122678961</span> <span class="token comment"># APPID</span>
  <span class="token key atrule">app-private-key</span><span class="token punctuation">:</span> MI<span class="token important">*********</span> <span class="token comment"># 应用私钥</span>
  <span class="token key atrule">app-cert-path</span><span class="token punctuation">:</span> /cert/appPublicCert.crt <span class="token comment"># 应用公钥证书路径</span>
  <span class="token key atrule">alipay-cert-path</span><span class="token punctuation">:</span> /cert/alipayPublicCert.crt <span class="token comment"># 支付宝公钥证书路径</span>
  <span class="token key atrule">root-cert-path</span><span class="token punctuation">:</span> /cert/alipayRootCert.crt <span class="token comment"># 支付宝根证书路径</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>其中证书加签模式的三个证书放在了项目<code>resources/cert</code> 目录下。除此之外的其它配置信息作为常量放到了 Java 类中。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AlipayConstant</span> <span class="token punctuation">{</span>

    <span class="token comment">// 支付宝网关地址沙箱环境下固定为：https://openapi.alipaydev.com/gateway.do</span>
    <span class="token comment">// 正式环境固定为：https://openapi.alipay.com/gateway.do</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> gateway <span class="token operator">=</span> <span class="token string">&quot;https://openapi.alipaydev.com/gateway.do&quot;</span><span class="token punctuation">;</span>

    <span class="token comment">// 接口加签方式</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> signType <span class="token operator">=</span> <span class="token string">&quot;RSA2&quot;</span><span class="token punctuation">;</span>

    <span class="token comment">// 字符编码格式</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> charset <span class="token operator">=</span> <span class="token string">&quot;utf-8&quot;</span><span class="token punctuation">;</span>

    <span class="token comment">// 数据传输格式</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> format <span class="token operator">=</span> <span class="token string">&quot;json&quot;</span><span class="token punctuation">;</span>

    <span class="token comment">// 页面跳转的同步通知路径，需http://格式的完整路径，且不能是内网路径，不能加?id=123这类自定义参数</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> returnUrl <span class="token operator">=</span> <span class="token string">&quot;http://localhost:8080/alipay/success&quot;</span><span class="token punctuation">;</span>
    
    <span class="token comment">// 支付宝服务器的异步通知路径，需http://格式的完整路径，且不能是内网路径</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> notifyUrl <span class="token operator">=</span> <span class="token string">&quot;http://localhost:8080/alipay/success&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>其中，同步通知地址可设置为后端支付成功的页面地址或前端支付成功的页面地址，异步通知地址必须由后端处理。在开发环境下可使用内网穿透工具来让我们本地的服务可以被支付宝服务访问到，进而触发异步通知。</p> <p>关于内网穿透工具，这里推荐 natapp，百度一下很快就能 get 到。</p> <h3 id="_2-3-创建支付客户端"><a href="#_2-3-创建支付客户端" class="header-anchor">#</a> 2.3 创建支付客户端</h3> <p>发送支付宝提供的各种支付接口都需要使用支付宝 SDK 提供的支付客户端，下面给出了证书模式的支付客户端的配置。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AlipayConfig</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${alipay.app-id}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> appId<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${alipay.app-private-key}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> privateKey<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${alipay.app-cert-path}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> appCertPath<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${alipay.alipay-cert-path}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> alipayCertPath<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${alipay.root-cert-path}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> rootCertPath<span class="token punctuation">;</span>


    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">AlipayClient</span> <span class="token function">getAlipayClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">AlipayApiException</span> <span class="token punctuation">{</span>

        <span class="token class-name">CertAlipayRequest</span> config <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CertAlipayRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        config<span class="token punctuation">.</span><span class="token function">setServerUrl</span><span class="token punctuation">(</span><span class="token class-name">AlipayConstant</span><span class="token punctuation">.</span>gateway<span class="token punctuation">)</span><span class="token punctuation">;</span>
        config<span class="token punctuation">.</span><span class="token function">setSignType</span><span class="token punctuation">(</span><span class="token class-name">AlipayConstant</span><span class="token punctuation">.</span>signType<span class="token punctuation">)</span><span class="token punctuation">;</span>
        config<span class="token punctuation">.</span><span class="token function">setCharset</span><span class="token punctuation">(</span><span class="token class-name">AlipayConstant</span><span class="token punctuation">.</span>charset<span class="token punctuation">)</span><span class="token punctuation">;</span>
        config<span class="token punctuation">.</span><span class="token function">setFormat</span><span class="token punctuation">(</span><span class="token class-name">AlipayConstant</span><span class="token punctuation">.</span>format<span class="token punctuation">)</span><span class="token punctuation">;</span>
        config<span class="token punctuation">.</span><span class="token function">setAppId</span><span class="token punctuation">(</span>appId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        config<span class="token punctuation">.</span><span class="token function">setPrivateKey</span><span class="token punctuation">(</span>privateKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        config<span class="token punctuation">.</span><span class="token function">setCertPath</span><span class="token punctuation">(</span><span class="token function">getRealPath</span><span class="token punctuation">(</span>appCertPath<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        config<span class="token punctuation">.</span><span class="token function">setAlipayPublicCertPath</span><span class="token punctuation">(</span><span class="token function">getRealPath</span><span class="token punctuation">(</span>alipayCertPath<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        config<span class="token punctuation">.</span><span class="token function">setRootCertPath</span><span class="token punctuation">(</span><span class="token function">getRealPath</span><span class="token punctuation">(</span>rootCertPath<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">DefaultAlipayClient</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> <span class="token function">getRealPath</span><span class="token punctuation">(</span><span class="token class-name">String</span> path<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">String</span> absolutePath <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            absolutePath <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassPathResource</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAbsolutePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;证书不存在&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> absolutePath<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br></div></div><h3 id="_2-4-创建业务接口"><a href="#_2-4-创建业务接口" class="header-anchor">#</a> 2.4 创建业务接口</h3> <p>这里不仅给出了支付业务的业务接口，还给出了转账以及退款的业务接口。此外这些接口所用到的参数在具体接入的时候会详细说明。</p> <p>业务接口返回的 Result 封装的统一响应处理类，代码如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@JsonInclude</span><span class="token punctuation">(</span><span class="token class-name">JsonInclude<span class="token punctuation">.</span>Include</span><span class="token punctuation">.</span><span class="token constant">NON_NULL</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Result</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">Integer</span> code<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> message<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">Object</span> data<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Result</span> <span class="token function">fail</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Result</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">,</span> message<span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Result</span> <span class="token function">success</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">,</span><span class="token class-name">Object</span> data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Result</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> message<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h4 id="_2-4-1-支付业务接口"><a href="#_2-4-1-支付业务接口" class="header-anchor">#</a> 2.4.1 支付业务接口</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">AlipayService</span> <span class="token punctuation">{</span>

    <span class="token comment">/**
     * 电脑网站支付
     * @param payParam 支付参数
     */</span>
    <span class="token class-name">String</span> <span class="token function">computePay</span><span class="token punctuation">(</span><span class="token class-name">PayParam</span> payParam<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * 手机网站支付
     * @param payParam 支付参数
     */</span>
    <span class="token class-name">String</span> <span class="token function">mobilePay</span><span class="token punctuation">(</span><span class="token class-name">PayParam</span> payParam<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * 当面付（用户扫描商户二维码支付）
     * @param payParam 支付参数
     */</span>
    <span class="token class-name">String</span> <span class="token function">faceToFacePay</span><span class="token punctuation">(</span><span class="token class-name">PayParam</span> payParam<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * 查询支付结果
     * @param payQueryParam 支付结果查询参数
     */</span>
    <span class="token class-name">Result</span> <span class="token function">queryPay</span><span class="token punctuation">(</span><span class="token class-name">PayQueryParam</span> payQueryParam<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * 查询对账单下载地址
     * @param billQueryParam 对账单下载地址查询参数
     */</span>
    <span class="token class-name">Result</span> <span class="token function">queryBill</span><span class="token punctuation">(</span><span class="token class-name">BillQueryParam</span> billQueryParam<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><h4 id="_2-4-2-通知业务接口"><a href="#_2-4-2-通知业务接口" class="header-anchor">#</a> 2.4.2 通知业务接口</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">AliNotifyService</span> <span class="token punctuation">{</span>

    <span class="token comment">/**
     * 请求的异步回调
     */</span>
    <span class="token keyword">void</span> <span class="token function">notifyCallback</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * 请求的同步回调
     */</span>
    <span class="token keyword">void</span> <span class="token function">returnCallback</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h4 id="_2-4-3-退款业务接口"><a href="#_2-4-3-退款业务接口" class="header-anchor">#</a> 2.4.3 退款业务接口</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">AliRefundService</span> <span class="token punctuation">{</span>

    <span class="token comment">/**
     * 退款
     * @param refundParam 退款参数
     */</span>
    <span class="token class-name">Result</span> <span class="token function">refund</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">RefundParam</span> refundParam<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * 查询退款结果
     * @param refundQueryParam 退款结果查询参数
     */</span>
    <span class="token class-name">Result</span> <span class="token function">queryRefund</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">RefundQueryParam</span> refundQueryParam<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h4 id="_2-4-4-转账业务接口"><a href="#_2-4-4-转账业务接口" class="header-anchor">#</a> 2.4.4 转账业务接口</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">AliTransferService</span> <span class="token punctuation">{</span>

    <span class="token comment">/**
     * 查询商户账户余额
     */</span>
    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">queryAccount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * 查询转账结果
     * @param queryParam 转账结果查询参数
     */</span>
    <span class="token class-name">Result</span> <span class="token function">queryTransfer</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">TransferQueryParam</span> queryParam<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * 单笔无密转账
     * @param transferParam 转账参数
     */</span>
    <span class="token class-name">Result</span> <span class="token function">transfer</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">TransferParam</span> transferParam<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h3 id="_2-5-创建请求接口"><a href="#_2-5-创建请求接口" class="header-anchor">#</a> 2.5 创建请求接口</h3> <p>下面给出了支付、通知、退款和转账等功能的请求接口。</p> <h4 id="_2-5-1-支付请求接口"><a href="#_2-5-1-支付请求接口" class="header-anchor">#</a> 2.5.1 支付请求接口</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;alipay&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AlipayController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">AlipayService</span> alipayService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;computer&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Result</span> <span class="token function">computerPay</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">PayParam</span> payParam<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> form <span class="token operator">=</span> alipayService<span class="token punctuation">.</span><span class="token function">computePay</span><span class="token punctuation">(</span>payParam<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token string">&quot;操作成功&quot;</span><span class="token punctuation">,</span>form<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;mobile&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Result</span> <span class="token function">mobilePay</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">PayParam</span> payParam<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> form <span class="token operator">=</span> alipayService<span class="token punctuation">.</span><span class="token function">mobilePay</span><span class="token punctuation">(</span>payParam<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token string">&quot;操作成功&quot;</span><span class="token punctuation">,</span>form<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;faceToFace&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Result</span> <span class="token function">faceToFacePay</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">PayParam</span> payParam<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> qrcode <span class="token operator">=</span> alipayService<span class="token punctuation">.</span><span class="token function">faceToFacePay</span><span class="token punctuation">(</span>payParam<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token string">&quot;操作成功&quot;</span><span class="token punctuation">,</span>qrcode<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;payQuery&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Result</span> <span class="token function">payQuery</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">PayQueryParam</span> payQuery<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> alipayService<span class="token punctuation">.</span><span class="token function">queryPay</span><span class="token punctuation">(</span>payQuery<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;billQuery&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Result</span> <span class="token function">billQuery</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">BillQueryParam</span> queryParam<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> downloadUrl <span class="token operator">=</span> alipayService<span class="token punctuation">.</span><span class="token function">queryBill</span><span class="token punctuation">(</span>queryParam<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> downloadUrl <span class="token operator">!=</span> <span class="token keyword">null</span>
                <span class="token operator">?</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token string">&quot;操作成功&quot;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
                <span class="token operator">:</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">fail</span><span class="token punctuation">(</span><span class="token string">&quot;操作失败&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br></div></div><h4 id="_2-5-2-通知请求接口"><a href="#_2-5-2-通知请求接口" class="header-anchor">#</a> 2.5.2 通知请求接口</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;aliNotify&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AliNotifyController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">AliNotifyService</span> aliNotifyService<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;notify&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">notifyCheck</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        aliNotifyService<span class="token punctuation">.</span><span class="token function">notifyCallback</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;return&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Result</span> <span class="token function">returnCheck</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">boolean</span> isChecked <span class="token operator">=</span> aliNotifyService<span class="token punctuation">.</span><span class="token function">returnCallback</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> isChecked <span class="token operator">?</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token string">&quot;支付成功&quot;</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">fail</span><span class="token punctuation">(</span><span class="token string">&quot;支付失败&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h4 id="_2-5-3-退款请求接口"><a href="#_2-5-3-退款请求接口" class="header-anchor">#</a> 2.5.3 退款请求接口</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;aliRefund&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AliRefundController</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">AliRefundService</span> aliRefundService<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;refund&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Result</span> <span class="token function">refund</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">RefundParam</span> refundParam<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span>  aliRefundService<span class="token punctuation">.</span><span class="token function">refund</span><span class="token punctuation">(</span>refundParam<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;queryRefund&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Result</span> <span class="token function">queryRefund</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">RefundQueryParam</span> queryParam<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> aliRefundService<span class="token punctuation">.</span><span class="token function">queryRefund</span><span class="token punctuation">(</span>queryParam<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h4 id="_2-5-4-转账请求接口"><a href="#_2-5-4-转账请求接口" class="header-anchor">#</a> 2.5.4 转账请求接口</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;aliTransfer&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AliTransferController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">AliTransferService</span> aliTransferService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;transfer&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Result</span> <span class="token function">transfer</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">TransferParam</span> transferParam<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> aliTransferService<span class="token punctuation">.</span><span class="token function">transfer</span><span class="token punctuation">(</span>transferParam<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;queryTransfer&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Result</span> <span class="token function">queryTransfer</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">TransferQueryParam</span> queryParam<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> aliTransferService<span class="token punctuation">.</span><span class="token function">queryTransfer</span><span class="token punctuation">(</span>queryParam<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;queryAccount&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Result</span> <span class="token function">queryAccount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> result <span class="token operator">=</span> aliTransferService<span class="token punctuation">.</span><span class="token function">queryAccount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token string">&quot;查询成功&quot;</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h2 id="三、支付接入"><a href="#三、支付接入" class="header-anchor">#</a> 三、支付接入</h2> <p>支付接入的流程都是类似的，下图是电脑网站支付的支付流程，在接入其它支付功能时会介绍其不同之处。</p> <p><img src="https://cdn.jsdelivr.net/gh/mengyahui/image-repository@master/springboot/image-20230522082056884.1dqo7xwys8g.jpg" alt="image-20230522082056884"></p> <h3 id="_3-1-电脑网站支付"><a href="#_3-1-电脑网站支付" class="header-anchor">#</a> 3.1 电脑网站支付</h3> <p>电脑网站支付会返回一个支付表单，需要在前端模拟表单提交来唤起支付窗口。用户<strong>扫描支付二维码</strong>或<strong>填写账号密码</strong>即可完成支付。</p> <h4 id="_3-1-1-请求参数"><a href="#_3-1-1-请求参数" class="header-anchor">#</a> 3.1.1 请求参数</h4> <table><thead><tr><th>参数</th> <th>是否必选</th> <th>描述</th></tr></thead> <tbody><tr><td>out_trade_no</td> <td>必选</td> <td>商户订单号</td></tr> <tr><td>total_amount</td> <td>必选</td> <td>订单总金额，单位为元，精确到小数点后两位，取值范围为 [0.01,100000000]。</td></tr> <tr><td>subject</td> <td>必选</td> <td>订单标题。注意：不可使用特殊字符，如 /，=，&amp; 等</td></tr> <tr><td>product_code</td> <td>必选</td> <td>销售产品码。目前电脑支付场景下仅支持 FAST_INSTANT_TRADE_PAY</td></tr> <tr><td>qr_pay_mode</td> <td>可选</td> <td>PC 扫码支付的方式。</td></tr> <tr><td>qrcode_width</td> <td>可选</td> <td>商户自定义二维码宽度。注：qr_pay_mode = 4 时该参数有效</td></tr></tbody></table> <p><code>qr_pay_mode</code>：PC 扫码支付支持前置模式和跳转模式，不传该参数默认是跳转模式。</p> <p><strong>前置模式</strong>：将二维码前置到商户的订单确认页，需要商户在自己的页面中以 iframe 方式请求支付宝页面。</p> <p><strong>跳转模式</strong>：用户的扫码界面是由支付宝生成的，不在商户的域名下。</p> <p>PC 端具体支持的扫码支付模式如下：</p> <ol><li><code>qr_pay_mode = 0</code>：订单码-简约前置模式，对应 iframe 宽度不能小于 600px，高度不能小于 300px；</li> <li><code>qr_pay_mode = 1</code>：订单码-前置模式，对应 iframe 宽度不能小于 300px，高度不能小于 600px；</li> <li><code>qr_pay_mode = 3</code>：订单码-迷你前置模式，对应 iframe 宽度不能小于 75px，高度不能小于75px；</li> <li><code>qr_pay_mode = 4</code>：订单码-可定义宽度的嵌入式二维码，商户可根据需要设定二维码的大小。</li> <li><code>qr_pay_mode = 2</code>：订单码-跳转模式。</li></ol> <p>这里以跳转模式为例，构造的支付参数为：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PayParam</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> outTradeNo<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> subject<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> totalAmount<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> qrPayMode<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> qrcodeWidth<span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h4 id="_3-1-2-支付逻辑"><a href="#_3-1-2-支付逻辑" class="header-anchor">#</a> 3.1.2 支付逻辑</h4> <blockquote><p>支付请求：<code>com.alipay.api.request.AlipayTradePagePayRequest</code></p> <p>业务参数：<code>com.alipay.api.domain.AlipayTradePagePayModel</code></p></blockquote> <p>电脑网站支付的逻辑如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AlipayServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">AlipayService</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">AlipayClient</span> alipayClient<span class="token punctuation">;</span>
    
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">computePay</span><span class="token punctuation">(</span><span class="token class-name">PcPayParam</span> payParam<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 创建电脑网站支付请求</span>
        <span class="token class-name">AlipayTradePagePayRequest</span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AlipayTradePagePayRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 设置异步回调地址</span>
        request<span class="token punctuation">.</span><span class="token function">setNotifyUrl</span><span class="token punctuation">(</span><span class="token class-name">AlipayConstant</span><span class="token punctuation">.</span>notifyUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 设置同步回调地址</span>
        request<span class="token punctuation">.</span><span class="token function">setReturnUrl</span><span class="token punctuation">(</span><span class="token class-name">AlipayConstant</span><span class="token punctuation">.</span>returnUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 创建业务参数对象</span>
        <span class="token class-name">AlipayTradePagePayModel</span> model <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AlipayTradePagePayModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        model<span class="token punctuation">.</span><span class="token function">setOutTradeNo</span><span class="token punctuation">(</span>payParam<span class="token punctuation">.</span><span class="token function">getOutTradeNo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        model<span class="token punctuation">.</span><span class="token function">setSubject</span><span class="token punctuation">(</span>payParam<span class="token punctuation">.</span><span class="token function">getSubject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        model<span class="token punctuation">.</span><span class="token function">setTotalAmount</span><span class="token punctuation">(</span>payParam<span class="token punctuation">.</span><span class="token function">getTotalAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">hasLength</span><span class="token punctuation">(</span>payParam<span class="token punctuation">.</span><span class="token function">getQrPayMode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            model<span class="token punctuation">.</span><span class="token function">setQrPayMode</span><span class="token punctuation">(</span>payParam<span class="token punctuation">.</span><span class="token function">getQrPayMode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>payParam<span class="token punctuation">.</span><span class="token function">getQrPayMode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;4&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                model<span class="token punctuation">.</span><span class="token function">setQrcodeWidth</span><span class="token punctuation">(</span>model<span class="token punctuation">.</span><span class="token function">getQrcodeWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        model<span class="token punctuation">.</span><span class="token function">setProductCode</span><span class="token punctuation">(</span><span class="token class-name">AlipayConstant</span><span class="token punctuation">.</span>computePayProductCode<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 设置业务参数</span>
        request<span class="token punctuation">.</span><span class="token function">setBizModel</span><span class="token punctuation">(</span>model<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">AlipayTradePagePayResponse</span> response <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">// 客户端发送请求</span>
            response <span class="token operator">=</span> alipayClient<span class="token punctuation">.</span><span class="token function">pageExecute</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">AlipayApiException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;支付宝返回支付表单失败&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">boolean</span> isSuccess <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">isSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> isSuccess <span class="token operator">?</span> response<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br></div></div><h4 id="_3-1-3-支付接口"><a href="#_3-1-3-支付接口" class="header-anchor">#</a> 3.1.3 支付接口</h4> <p>电脑网站支付的接口如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;alipay&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AlipayController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">AlipayService</span> alipayService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;pc&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Result</span> <span class="token function">computerPay</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">PcPayParam</span> payParam<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> form <span class="token operator">=</span> alipayService<span class="token punctuation">.</span><span class="token function">computePay</span><span class="token punctuation">(</span>payParam<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> form <span class="token operator">!=</span> <span class="token keyword">null</span>
                <span class="token operator">?</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token string">&quot;操作成功&quot;</span><span class="token punctuation">,</span>form<span class="token punctuation">)</span>
                <span class="token operator">:</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">fail</span><span class="token punctuation">(</span><span class="token string">&quot;返回支付表单失败&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h4 id="_3-1-4-渲染表单"><a href="#_3-1-4-渲染表单" class="header-anchor">#</a> 3.1.4 渲染表单</h4> <p>电脑网站支付的接口返回的 form 字符串需要在商家客户端模拟 js 提交表单来获取支付页面。如果前端使用的是 vue 可以像下面这样来渲染 form。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token generics"><span class="token punctuation">&lt;</span>script<span class="token punctuation">&gt;</span></span>
<span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    el<span class="token operator">:</span> <span class="token char">'#app'</span><span class="token punctuation">,</span>
    data<span class="token operator">:</span> <span class="token punctuation">{</span>
        form<span class="token operator">:</span> <span class="token punctuation">{</span>
            outTradeNo<span class="token operator">:</span> '<span class="token number">1213456</span>'<span class="token punctuation">,</span>
            subject<span class="token operator">:</span> <span class="token char">'测试支付'</span><span class="token punctuation">,</span>
            totalAmount<span class="token operator">:</span> <span class="token char">'1'</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    methods<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token function">submit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">fetch</span><span class="token punctuation">(</span>'alipay<span class="token operator">/</span>computer'<span class="token punctuation">,</span><span class="token punctuation">{</span>
                method<span class="token operator">:</span> <span class="token char">'POST'</span><span class="token punctuation">,</span>
                body<span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>form<span class="token punctuation">)</span><span class="token punctuation">,</span>
                headers<span class="token operator">:</span> <span class="token punctuation">{</span>
                    '<span class="token class-name">Content</span><span class="token operator">-</span><span class="token class-name">Type</span><span class="token char">': '</span>application<span class="token operator">/</span>json'
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>response <span class="token operator">=</span><span class="token operator">&gt;</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>response <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
                    <span class="token keyword">const</span> <span class="token punctuation">{</span> data <span class="token punctuation">}</span> <span class="token operator">=</span> response
                    <span class="token keyword">const</span> div <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span>'payForm'<span class="token punctuation">)</span>
                    div<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> data
                    document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>div<span class="token punctuation">)</span>
                    <span class="token keyword">const</span> len <span class="token operator">=</span> document<span class="token punctuation">.</span>forms<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span>
                    document<span class="token punctuation">.</span>forms<span class="token punctuation">[</span>len<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token char">'target'</span><span class="token punctuation">,</span> <span class="token char">'_blank'</span><span class="token punctuation">)</span>
                    document<span class="token punctuation">.</span>forms<span class="token punctuation">[</span>len<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><h4 id="_3-1-5-接口回调"><a href="#_3-1-5-接口回调" class="header-anchor">#</a> 3.1.5 接口回调</h4> <p>在向支付宝发送请求时，我们配置了支付宝的同步回调地址和异步回调地址，当支付宝服务器接收到这个支付请求时会通过同步回调接口返回一个结果，但是这个结果，只是告诉你调用成功了，并不是扣款成功。当支付宝服务器完成扣款接口的调用时，才会通过异步回调接口通知商家客户端支付是否成功。</p> <p>通常，在同步接口中处理订单逻辑，将“待支付”状态更新为 “已支付”状态，在根据异步接口的处理结果进一步确认该笔订单是否支付成功。</p> <p><strong>接口验签：</strong></p> <p>无论是同步回调还是异步回调，都需要进行接口验签，且验签代码比较固定。下面接入的支付功能不再提及。下面的代码是验签的逻辑，只需要在同步回调和异步回调接口中调用即可。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Service</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AliNotifyServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">AliNotifyService</span> <span class="token punctuation">{</span>
    
    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${alipay.alipay-cert-path}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> alipayCertPath<span class="token punctuation">;</span>
    
    <span class="token keyword">private</span> <span class="token keyword">boolean</span> <span class="token function">check</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 获取订单号</span>
        <span class="token class-name">String</span> out_trade_no <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">&quot;out_trade_no&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 获取支付宝交易号</span>
        <span class="token class-name">String</span> trade_no <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">&quot;trade_no&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 获取验签 Map</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> paramMap <span class="token operator">=</span> <span class="token function">convertRequestParamsToMap</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token class-name">AlipaySignature</span><span class="token punctuation">.</span><span class="token function">rsaCertCheckV1</span><span class="token punctuation">(</span>
                paramMap<span class="token punctuation">,</span> 
                alipayCertPath<span class="token punctuation">,</span> 
                <span class="token class-name">AlipayConstant</span><span class="token punctuation">.</span>charset<span class="token punctuation">,</span> 
                <span class="token class-name">AlipayConstant</span><span class="token punctuation">.</span>signType
            <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">AlipayApiException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;支付宝验签失败,订单号{},支付宝交易号{}&quot;</span><span class="token punctuation">,</span>out_trade_no<span class="token punctuation">,</span>trade_no<span class="token punctuation">)</span><span class="token punctuation">;</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">convertRequestParamsToMap</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> retMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Map</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> requestParams <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getParameterMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> name <span class="token operator">:</span> requestParams<span class="token punctuation">.</span><span class="token function">keySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> values <span class="token operator">=</span> requestParams<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> valueStr <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> values<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                valueStr <span class="token operator">=</span> <span class="token punctuation">(</span>i <span class="token operator">==</span> values<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> 
                    <span class="token operator">?</span> valueStr <span class="token operator">+</span> values<span class="token punctuation">[</span>i<span class="token punctuation">]</span> 
                    <span class="token operator">:</span> valueStr <span class="token operator">+</span> values<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">&quot;,&quot;</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            retMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> valueStr<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> retMap<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br></div></div><p><strong>同步回调：</strong></p> <p>在同步回调逻辑：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Service</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AliNotifyServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">AliNotifyService</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">returnCallback</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 获取订单号</span>
        <span class="token class-name">String</span> out_trade_no <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">&quot;out_trade_no&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 获取支付宝交易号</span>
        <span class="token class-name">String</span> trade_no <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">&quot;trade_no&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 接口验签</span>
        <span class="token keyword">boolean</span> isChecked <span class="token operator">=</span> <span class="token function">check</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>isChecked<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;支付宝同步验签成功,订单号：{},支付宝交易号：{}&quot;</span><span class="token punctuation">,</span> out_trade_no<span class="token punctuation">,</span> trade_no<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 处理订单逻辑</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;支付宝同步验签失败,订单号：{},支付宝交易号：{}&quot;</span><span class="token punctuation">,</span> out_trade_no<span class="token punctuation">,</span> trade_no<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> isChecked<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>对于同步回调的接口来说，商户服务端可选择服务端渲染支付成功页，也可以选择直接跳转至商户客户端指定的成功页面。这里选择跳转至商户客户端指定的成功页面。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Controller</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;aliNotify&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AliNotifyController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">AliNotifyService</span> aliNotifyService<span class="token punctuation">;</span>
    
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;return&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">returnCheck</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">boolean</span> isChecked <span class="token operator">=</span> aliNotifyService<span class="token punctuation">.</span><span class="token function">returnCallback</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>isChecked<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                response<span class="token punctuation">.</span><span class="token function">sendRedirect</span><span class="token punctuation">(</span><span class="token string">&quot;http://localhost:5173/#/success&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                response<span class="token punctuation">.</span><span class="token function">sendRedirect</span><span class="token punctuation">(</span><span class="token string">&quot;http://localhost:5173/#/error&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;同步跳转失败&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p><strong>异步回调：</strong></p> <p>异步回调逻辑：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Service</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AliNotifyServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">AliNotifyService</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">notifyCallback</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 获取交易状态</span>
        <span class="token class-name">String</span> trade_status <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">&quot;trade_status&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 获取订单号</span>
        <span class="token class-name">String</span> out_trade_no <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">&quot;out_trade_no&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 获取支付宝交易号</span>
        <span class="token class-name">String</span> trade_no <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">&quot;trade_no&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 接口验签</span>
        <span class="token keyword">boolean</span> isChecked <span class="token operator">=</span> <span class="token function">check</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>isChecked<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;支付宝异步回调验签成功,订单号{},支付宝交易号{}&quot;</span><span class="token punctuation">,</span> out_trade_no<span class="token punctuation">,</span> trade_no<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 判断交易是否成功</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>tradeStatus<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;TRADE_SUCCESS&quot;</span><span class="token punctuation">)</span><span class="token operator">||</span>tradeStatus<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;TRADE_FINISHED&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// 查询数据库中订单是否支付成功，支付成功则无需做操作，否则需要更新订单状态</span>
                log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;订单{}支付成功,支付宝交易号:{}&quot;</span><span class="token punctuation">,</span> out_trade_no<span class="token punctuation">,</span> trade_no<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// 交易成功后需要向支付宝返回success字符串，</span>
                <span class="token comment">// 否则支付宝后台会在一定的时间间隔内重复发起异步回调返回支付结果</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    response<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;success&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;IO异常,订单号{},支付宝交易号{}&quot;</span><span class="token punctuation">,</span>out_trade_no<span class="token punctuation">,</span> trade_no<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;支付宝异步验签失败,订单号{},支付宝交易号{}&quot;</span><span class="token punctuation">,</span> out_trade_no<span class="token punctuation">,</span> trade_no<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><h3 id="_3-2-手机网站支付"><a href="#_3-2-手机网站支付" class="header-anchor">#</a> 3.2 手机网站支付</h3> <p>和电脑网站支付类似，手机网站支付同样会返回一个支付表单，需要前端模拟表单提交来唤起支付窗口。不同的是，手机网站的支付窗口可以选择调出支付宝 app 付款或在浏览器中输入支付宝账号和密码来完成支付。</p> <p>手机网站支付和电脑网站支付的流程一致，接口的回调处理逻辑也是一致的。</p> <blockquote><p>支付请求：<code>com.alipay.api.request.AlipayTradeWapPayRequest</code></p> <p>业务参数：<code>com.alipay.api.domain.AlipayTradeWapPayModel</code></p></blockquote> <h4 id="_3-2-1-请求参数"><a href="#_3-2-1-请求参数" class="header-anchor">#</a> 3.2.1 请求参数</h4> <table><thead><tr><th>参数</th> <th>是否必选</th> <th>描述</th></tr></thead> <tbody><tr><td>out_trade_no</td> <td>必选</td> <td>商户网站唯一订单号</td></tr> <tr><td>total_amount</td> <td>必选</td> <td>订单总金额。单位为元，精确到小数点后两位，取值范围：[0.01,100000000]</td></tr> <tr><td>subject</td> <td>必选</td> <td>订单标题。注意：不可使用特殊字符，如 /，=，&amp; 等。</td></tr> <tr><td>quit_url</td> <td>可选</td> <td>用户付款中途退出返回商户网站的地址</td></tr></tbody></table> <p>构造出手机网站支付的请求参数为：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MobilePayParam</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> outTradeNo<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> subject<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> totalAmount<span class="token punctuation">;</span>
    
    <span class="token keyword">private</span> <span class="token class-name">String</span> quitUrl<span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h4 id="_3-2-1-支付逻辑"><a href="#_3-2-1-支付逻辑" class="header-anchor">#</a> 3.2 1 支付逻辑</h4> <p>手机网站支付的支付逻辑如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Service</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AlipayServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">AlipayService</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">AlipayClient</span> alipayClient<span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">mobilePay</span><span class="token punctuation">(</span><span class="token class-name">MobilePayParam</span> payParam<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 创建请求对象</span>
        <span class="token class-name">AlipayTradeWapPayRequest</span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AlipayTradeWapPayRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 设置回调地址</span>
        request<span class="token punctuation">.</span><span class="token function">setNotifyUrl</span><span class="token punctuation">(</span><span class="token class-name">AlipayConstant</span><span class="token punctuation">.</span>notifyUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
        request<span class="token punctuation">.</span><span class="token function">setReturnUrl</span><span class="token punctuation">(</span><span class="token class-name">AlipayConstant</span><span class="token punctuation">.</span>returnUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 创建业务对象</span>
        <span class="token class-name">AlipayTradeWapPayModel</span> model <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AlipayTradeWapPayModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 设置业务参数</span>
        model<span class="token punctuation">.</span><span class="token function">setOutTradeNo</span><span class="token punctuation">(</span>payParam<span class="token punctuation">.</span><span class="token function">getOutTradeNo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        model<span class="token punctuation">.</span><span class="token function">setSubject</span><span class="token punctuation">(</span>payParam<span class="token punctuation">.</span><span class="token function">getSubject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        model<span class="token punctuation">.</span><span class="token function">setTotalAmount</span><span class="token punctuation">(</span>payParam<span class="token punctuation">.</span><span class="token function">getTotalAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        model<span class="token punctuation">.</span><span class="token function">setProductCode</span><span class="token punctuation">(</span><span class="token class-name">AlipayConstant</span><span class="token punctuation">.</span>mobilePayProductCode<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">hasLength</span><span class="token punctuation">(</span>payParam<span class="token punctuation">.</span><span class="token function">getQuitUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            model<span class="token punctuation">.</span><span class="token function">setQuitUrl</span><span class="token punctuation">(</span>payParam<span class="token punctuation">.</span><span class="token function">getQuitUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        request<span class="token punctuation">.</span><span class="token function">setBizModel</span><span class="token punctuation">(</span>model<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">AlipayTradeWapPayResponse</span> response<span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">// 发送请求</span>
            response <span class="token operator">=</span> alipayClient<span class="token punctuation">.</span><span class="token function">pageExecute</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">AlipayApiException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;支付宝返回支付表单失败&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">boolean</span> isSuccess <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">isSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> isSuccess <span class="token operator">?</span> response<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br></div></div><h3 id="_3-3-当面付-买家扫描商户二维码"><a href="#_3-3-当面付-买家扫描商户二维码" class="header-anchor">#</a> 3.3 当面付（<em>买家扫描商户二维码</em>）</h3> <p>首先商家后台调用支付宝扫码支付接口，返回给商家后台一个支付二维码地址，商家后台需要将其转换成二维码，提供给买家。</p> <p>和电脑网站支付类似，调用的都是交易创建类型的接口，支付的结果的返回时间依赖于用户何时扫码，所以此种支付方式也需要接口回调。</p> <blockquote><p>请求对象：<code>com.alipay.api.request.AlipayTradePrecreateRequest</code></p> <p>业务对象：<code>com.alipay.api.domain.AlipayTradePrecreateModel</code></p></blockquote> <h4 id="_3-3-1-请求参数"><a href="#_3-3-1-请求参数" class="header-anchor">#</a> 3.3.1 请求参数</h4> <table><thead><tr><th>参数</th> <th>是否必选</th> <th>描述</th></tr></thead> <tbody><tr><td>out_trade_no</td> <td>必选</td> <td>商户订单号。</td></tr> <tr><td>total_amount</td> <td>必选</td> <td>订单总金额。单位为元，精确到小数点后两位，取值范围：[0.01,100000000]</td></tr> <tr><td>subject</td> <td>必选</td> <td>订单标题。注意：不可使用特殊字符，如 /，=，&amp; 等。</td></tr> <tr><td>product_code</td> <td>可选</td> <td>产品码。当面付默认为 FACE_TO_FACE_PAYMENT，如果签约的是当面付快捷版，则传 OFFLINE_PAYMENT</td></tr></tbody></table> <p>构造出当面付的请求参数实体为：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FTFPayParam</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> outTradeNo<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> totalAmount<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> subject<span class="token punctuation">;</span>
    
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h4 id="_3-3-2-支付逻辑"><a href="#_3-3-2-支付逻辑" class="header-anchor">#</a> 3.3.2 支付逻辑</h4> <p>这里将支付地址转换为二维码的工具是 Zxing，这里不介绍。当面付支付的逻辑代码如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AlipayServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">AlipayService</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">AlipayClient</span> alipayClient<span class="token punctuation">;</span>
	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">faceToFacePay</span><span class="token punctuation">(</span><span class="token class-name">FTFPayParam</span> payParam<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">AlipayTradePrecreateRequest</span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AlipayTradePrecreateRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        request<span class="token punctuation">.</span><span class="token function">setNotifyUrl</span><span class="token punctuation">(</span><span class="token class-name">AlipayConstant</span><span class="token punctuation">.</span>notifyUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
        request<span class="token punctuation">.</span><span class="token function">setReturnUrl</span><span class="token punctuation">(</span><span class="token class-name">AlipayConstant</span><span class="token punctuation">.</span>returnUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">AlipayTradePrecreateModel</span> model <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AlipayTradePrecreateModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        model<span class="token punctuation">.</span><span class="token function">setOutTradeNo</span><span class="token punctuation">(</span>payParam<span class="token punctuation">.</span><span class="token function">getOutTradeNo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        model<span class="token punctuation">.</span><span class="token function">setSubject</span><span class="token punctuation">(</span>payParam<span class="token punctuation">.</span><span class="token function">getSubject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        model<span class="token punctuation">.</span><span class="token function">setTotalAmount</span><span class="token punctuation">(</span>payParam<span class="token punctuation">.</span><span class="token function">getTotalAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        model<span class="token punctuation">.</span><span class="token function">setProductCode</span><span class="token punctuation">(</span><span class="token class-name">AlipayConstant</span><span class="token punctuation">.</span>faceToFaceProductCode<span class="token punctuation">)</span><span class="token punctuation">;</span>
        request<span class="token punctuation">.</span><span class="token function">setBizModel</span><span class="token punctuation">(</span>model<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> qrCode <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token class-name">AlipayTradePrecreateResponse</span> response <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            response <span class="token operator">=</span> alipayClient<span class="token punctuation">.</span><span class="token function">certificateExecute</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">AlipayApiException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;返回当面付二维码异常&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">.</span><span class="token function">isSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 转换为 base64 格式的二维码图片</span>
            qrCode <span class="token operator">=</span> <span class="token class-name">QRCodeHelper</span><span class="token punctuation">.</span><span class="token function">toBase64</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span><span class="token function">getQrCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
            
        <span class="token keyword">return</span> qrCode<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><h3 id="_3-4-支付结果查询"><a href="#_3-4-支付结果查询" class="header-anchor">#</a> 3.4 支付结果查询</h3> <p>前面的几种支付功能都是通过支付宝回调来确定支付状态的，但如果商户端出现了异常，如网络异常、服务器异常等，可能会导致商户系统接收不到支付通知，更不用说对订单的支付状态进行变更了。</p> <p>支付宝提供了所有支付订单的查询接口，商户可根据这个接口主动查询支付结果，进而修改订单支付状态。</p> <h4 id="_3-4-1-请求参数"><a href="#_3-4-1-请求参数" class="header-anchor">#</a> 3.4.1 请求参数</h4> <table><thead><tr><th>参数</th> <th>是否必选</th> <th>描述</th></tr></thead> <tbody><tr><td>out_trade_no</td> <td>特殊可选</td> <td>订单支付时传入的商户订单号,和支付宝交易号不能同时为空。</td></tr> <tr><td>trade_no</td> <td>特殊可选</td> <td>支付宝交易号</td></tr> <tr><td>query_options</td> <td>可选</td> <td>查询选项</td></tr></tbody></table> <p><code>trade_no</code> 和 <code>out_trade_no</code> 如果同时存在优先取 <code>trade_no</code>；</p> <p>查询选项 <code>query_options</code> 为数组类型，用于定制支付结果查询接口同步返回的字段，其可选值有：</p> <ol><li>trade_settle_info：返回的交易结算信息，包含分账、补差等信息；</li> <li>fund_bill_list：交易支付使用的资金渠道；</li> <li>voucher_detail_list：交易支付时使用的所有优惠券信息；</li> <li>discount_goods_detail：交易支付所使用的单品券优惠的商品优惠信息；</li> <li>mdiscount_amount：商家优惠金额；</li></ol> <h4 id="_3-4-2-业务逻辑"><a href="#_3-4-2-业务逻辑" class="header-anchor">#</a> 3.4.2 业务逻辑</h4> <p>支付结果查询逻辑代码如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Service</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AlipayServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">AlipayService</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">AlipayClient</span> alipayClient<span class="token punctuation">;</span>
	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Result</span> <span class="token function">queryPay</span><span class="token punctuation">(</span><span class="token class-name">PayQueryParam</span> payQueryParam<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 创建支付结果查询请求对象</span>
        <span class="token class-name">AlipayTradeQueryRequest</span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AlipayTradeQueryRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 创建支付结果查询业务对象</span>
        <span class="token class-name">AlipayTradeQueryModel</span> model <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AlipayTradeQueryModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">hasLength</span><span class="token punctuation">(</span>payQueryParam<span class="token punctuation">.</span><span class="token function">getOutTradeNo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            model<span class="token punctuation">.</span><span class="token function">setOutTradeNo</span><span class="token punctuation">(</span>payQueryParam<span class="token punctuation">.</span><span class="token function">getOutTradeNo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">hasLength</span><span class="token punctuation">(</span>payQueryParam<span class="token punctuation">.</span><span class="token function">getTradeNo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            model<span class="token punctuation">.</span><span class="token function">setTradeNo</span><span class="token punctuation">(</span>payQueryParam<span class="token punctuation">.</span><span class="token function">getTradeNo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        model<span class="token punctuation">.</span><span class="token function">setQueryOptions</span><span class="token punctuation">(</span>payQueryParam<span class="token punctuation">.</span><span class="token function">getQueryOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 设置业务参数</span>
        request<span class="token punctuation">.</span><span class="token function">setBizModel</span><span class="token punctuation">(</span>model<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 发送支付查询请求</span>
        <span class="token class-name">AlipayTradeQueryResponse</span> response <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            response <span class="token operator">=</span> alipayClient<span class="token punctuation">.</span><span class="token function">certificateExecute</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">AlipayApiException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;支付结果查询异常&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 获取支付状态</span>
        <span class="token class-name">String</span> trade_status <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">getTradeStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span><span class="token function">isSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">&quot;WAIT_BUYER_PAY&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>trade_status<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 交易创建等待买家付款</span>
                <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token string">&quot;等待买家付款&quot;</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;TRADE_CLOSED&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>trade_status<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">//交易超时，或支付完成后全额退款</span>
                <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token string">&quot;交易超时或支付完成后全额退款&quot;</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;TRADE_SUCCESS&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>trade_status<span class="token punctuation">)</span><span class="token operator">||</span> <span class="token string">&quot;TRADE_FINISHED&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>trade_status<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 支付成功</span>
                <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token string">&quot;支付成功&quot;</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">fail</span><span class="token punctuation">(</span><span class="token string">&quot;支付结果查询失败&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br></div></div><p>支付结果查询的接口如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;alipay&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AlipayController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">AlipayService</span> alipayService<span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;payQuery&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Result</span> <span class="token function">payQuery</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">PayQueryParam</span> payQuery<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> alipayService<span class="token punctuation">.</span><span class="token function">queryPay</span><span class="token punctuation">(</span>payQuery<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h2 id="四、退款接入"><a href="#四、退款接入" class="header-anchor">#</a> 四、退款接入</h2> <p>退款的流程和支付的流程都是类似的。需要注意的是，支付宝退款除了支持全额退款外还支持单笔交易分多次退款。</p> <p>接入退款功能时，我们应该考虑*如何判断退款是否成功？*支付宝官方文档给出的答案很明确：</p> <p>先通过退款请求的同步响应的 <code>fund_change</code> 参数，来判断退款是否成功，<code>fund_change=Y</code> 为退款成功，<code>fund_change=N</code> 或无此字段时需要通过退款查询接口来进一步确定退款状态。其中<code>fund_change=N</code> 不代表交易没有退款，只是代表该次接口请求没有资金变动，此时需使用退款查询接口进行查询判断，该笔交易是退款失败，还是退款成功后重复操作导致。</p> <h3 id="_4-1-退款"><a href="#_4-1-退款" class="header-anchor">#</a> 4.1 退款</h3> <p>如果要实现单笔交易多次退款需要保证订单号不变且需要设置不同的退款交易号。当一笔退款失败后，再次发起退款需要保证退款请求号不能变更。</p> <p>全额退款时，支付宝是不会进行异步调用的；而部分退款，则一定会触发异步通知。所以在接入退款功能时并不建议以异步回调的结果作为退款是否成功的依据。</p> <h4 id="_4-1-1-请求参数"><a href="#_4-1-1-请求参数" class="header-anchor">#</a> 4.1.1 请求参数</h4> <table><thead><tr><th>参数</th> <th>是否必选</th> <th>描述</th></tr></thead> <tbody><tr><td>out_trade_no</td> <td>特殊可选</td> <td>商户订单号。</td></tr> <tr><td>trade_no</td> <td>特殊可选</td> <td>支付宝交易号。</td></tr> <tr><td>refund_amount</td> <td>必选</td> <td>退款金额。需要退款的金额，该金额不能大于订单金额</td></tr> <tr><td>refund_reason</td> <td>可选</td> <td>退款原因说明。</td></tr> <tr><td>out_request_no</td> <td>可选</td> <td>退款请求号。标识一次退款请求，如需部分退款，则此参数必传。</td></tr> <tr><td>query_options</td> <td>可选</td> <td>查询选项。商户通过上送该参数来定制同步需要额外返回的字段，数组格式。</td></tr></tbody></table> <p>商户订单号 <code>out_trade_no</code> 和支付宝交易号 <code>trade_no</code> 不能同时为空；查询选项<code>query_options</code> 的可选值为：<code>refund_detail_item_list</code>：退款使用的资金渠道；<code>deposit_back_info</code>：触发银行卡冲退信息通知；</p> <p>由此构造的退款参数实体为：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RefundParam</span> <span class="token punctuation">{</span>

    <span class="token comment">// 订单号</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> outTradeNo<span class="token punctuation">;</span>

    <span class="token comment">// 支付宝交易号</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> tradeNo<span class="token punctuation">;</span>

    <span class="token comment">// 退款金额</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> refundAmount<span class="token punctuation">;</span>

    <span class="token comment">// 退款原因，可选参数</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> refundReason<span class="token punctuation">;</span>

    <span class="token comment">// 退款请求号，可选参数</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> outRequestNo<span class="token punctuation">;</span>

    <span class="token comment">// 查询选项，可选参数</span>
    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> queryOptions<span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h4 id="_4-1-2-响应参数"><a href="#_4-1-2-响应参数" class="header-anchor">#</a> 4.1.2 响应参数</h4> <table><thead><tr><th>参数</th> <th>是否固定</th> <th>描述</th></tr></thead> <tbody><tr><td>trade_no</td> <td>固定</td> <td>支付宝交易号</td></tr> <tr><td>out_trade_no</td> <td>固定</td> <td>商户订单号</td></tr> <tr><td>buyer_logon_id</td> <td>固定</td> <td>用户的登录id</td></tr> <tr><td>fund_change</td> <td>固定</td> <td>本次退款是否发生了资金变化，Y：发生变化，N：未变化</td></tr> <tr><td>refund_fee</td> <td>固定</td> <td>退款总金额。指该笔交易累计已经退款成功的金额。</td></tr></tbody></table> <h4 id="_4-1-3-退款逻辑"><a href="#_4-1-3-退款逻辑" class="header-anchor">#</a> 4.1.3 退款逻辑</h4> <blockquote><p>请求对象：<code>com.alipay.api.request.AlipayTradeRefundRequest</code></p> <p>业务对象：<code>com.alipay.api.domain.AlipayTradeRefundModel</code></p></blockquote> <p>退款的逻辑如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AliRefundServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">AliRefundService</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">AlipayClient</span> alipayClient<span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Result</span> <span class="token function">refund</span><span class="token punctuation">(</span><span class="token class-name">RefundParam</span> refundParam<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 创建退款请求</span>
        <span class="token class-name">AlipayTradeRefundRequest</span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AlipayTradeRefundRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 创建请求参数对象</span>
        <span class="token class-name">AlipayTradeRefundModel</span> model <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AlipayTradeRefundModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>refundParam<span class="token punctuation">.</span><span class="token function">getOutRequestNo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            model<span class="token punctuation">.</span><span class="token function">setOutTradeNo</span><span class="token punctuation">(</span>refundParam<span class="token punctuation">.</span><span class="token function">getOutTradeNo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>refundParam<span class="token punctuation">.</span><span class="token function">getTradeNo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            model<span class="token punctuation">.</span><span class="token function">setTradeNo</span><span class="token punctuation">(</span>refundParam<span class="token punctuation">.</span><span class="token function">getTradeNo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        model<span class="token punctuation">.</span><span class="token function">setRefundAmount</span><span class="token punctuation">(</span>refundParam<span class="token punctuation">.</span><span class="token function">getRefundAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        model<span class="token punctuation">.</span><span class="token function">setRefundReason</span><span class="token punctuation">(</span>refundParam<span class="token punctuation">.</span><span class="token function">getRefundReason</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 设置请求参数</span>
        request<span class="token punctuation">.</span><span class="token function">setBizModel</span><span class="token punctuation">(</span>model<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">AlipayTradeRefundResponse</span> response<span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">// 发送退款请求</span>
            response <span class="token operator">=</span> alipayClient<span class="token punctuation">.</span><span class="token function">certificateExecute</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">AlipayApiException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;退款失败&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 退款结果</span>
        <span class="token class-name">String</span> fundChange <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">getFundChange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">.</span><span class="token function">isSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>fundChange<span class="token punctuation">,</span> <span class="token string">&quot;Y&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 退款成功</span>
                <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token string">&quot;退款成功&quot;</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token comment">// 退款调用资金未变动，查询退款结果</span>
                <span class="token comment">// 构造退款查询参数</span>
                <span class="token class-name">RefundQueryParam</span> refundQueryParam <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RefundQueryParam</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">BeanUtils</span><span class="token punctuation">.</span><span class="token function">copyProperties</span><span class="token punctuation">(</span>refundParam<span class="token punctuation">,</span>refundQueryParam<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// 调用退款查询接口，进一步判断退款状态</span>
                <span class="token keyword">return</span> <span class="token function">queryRefund</span><span class="token punctuation">(</span>refundQueryParam<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">fail</span><span class="token punctuation">(</span><span class="token string">&quot;退款失败&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br></div></div><h3 id="_4-2-退款结果查询"><a href="#_4-2-退款结果查询" class="header-anchor">#</a> 4.2 退款结果查询</h3> <p>退款查询接口返回 code=10000 并不代表退款成功，仅仅代表本次退款结果查询接口请求成功。如果退款查询接口的 <code>trade_no</code>、<code>out_trade_no</code>、<code>out_request_no</code> 和退款接口的不一致，则退款查询接口不会返回具体的退款信息，退款结果查询接口可在返回 code=10000 的前提下根据具体的退款信息判断退款是否成功。</p> <h4 id="_4-2-1-请求参数"><a href="#_4-2-1-请求参数" class="header-anchor">#</a> 4.2.1 请求参数</h4> <table><thead><tr><th>参数</th> <th>是否必选</th> <th>描述</th></tr></thead> <tbody><tr><td>trade_no</td> <td>特殊可选</td> <td>支付宝交易号</td></tr> <tr><td>out_trade_no</td> <td>特殊可选</td> <td>商户订单号</td></tr> <tr><td>out_request_no</td> <td>必选</td> <td>退款请求号，如果在退款请求时未传入，则该值为创建交易时的商户订单号</td></tr> <tr><td>query_options</td> <td>可选</td> <td>查询选项</td></tr></tbody></table> <p>支付宝交易号 <code>trade_no</code> 和商户订单号 <code>out_trade_no</code> 不能同时为空。</p> <p>查询选项 <code>query_options</code> 用于定制同步需要额外返回的信息字段，数组格式，可选值如下：</p> <ol><li><p>refund_detail_item_list：本次退款使用的资金渠道；</p></li> <li><p>gmt_refund_pay：退款执行成功的时间；</p></li> <li><p>deposit_back_info：银行卡冲退信息；</p></li></ol> <p>由此构造出的请求参数实体为：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RefundQueryParam</span> <span class="token punctuation">{</span>

    <span class="token comment">// 支付宝交易号</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> tradeNo<span class="token punctuation">;</span>

    <span class="token comment">// 订单号</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> outTradeNo<span class="token punctuation">;</span>

    <span class="token comment">// 退款请求号</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> outRequestNo<span class="token punctuation">;</span>

    <span class="token comment">// 查询选项，可选参数</span>
    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> queryOptions<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h4 id="_4-2-2-业务逻辑"><a href="#_4-2-2-业务逻辑" class="header-anchor">#</a> 4.2.2 业务逻辑</h4> <blockquote><p>请求对象：<code>com.alipay.api.request.AlipayTradeFastpayRefundQueryRequest</code></p> <p>业务对象：<code>com.alipay.api.domain.AlipayTradeFastpayRefundQueryModel</code></p></blockquote> <p>退款结果查询的实现逻辑如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AliRefundServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">AliRefundService</span> <span class="token punctuation">{</span>
    
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Result</span> <span class="token function">queryRefund</span><span class="token punctuation">(</span><span class="token class-name">RefundQueryParam</span> refundQueryParam<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 创建请求</span>
        <span class="token class-name">AlipayTradeFastpayRefundQueryRequest</span> request <span class="token operator">=</span> 
            <span class="token keyword">new</span> <span class="token class-name">AlipayTradeFastpayRefundQueryRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 创建请求参数对象</span>
        <span class="token class-name">AlipayTradeFastpayRefundQueryModel</span> model <span class="token operator">=</span> 
            <span class="token keyword">new</span> <span class="token class-name">AlipayTradeFastpayRefundQueryModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">hasLength</span><span class="token punctuation">(</span>refundQueryParam<span class="token punctuation">.</span><span class="token function">getOutTradeNo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            model<span class="token punctuation">.</span><span class="token function">setOutTradeNo</span><span class="token punctuation">(</span>refundQueryParam<span class="token punctuation">.</span><span class="token function">getOutTradeNo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">hasLength</span><span class="token punctuation">(</span>refundQueryParam<span class="token punctuation">.</span><span class="token function">getTradeNo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            model<span class="token punctuation">.</span><span class="token function">setTradeNo</span><span class="token punctuation">(</span>refundQueryParam<span class="token punctuation">.</span><span class="token function">getTradeNo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        model<span class="token punctuation">.</span><span class="token function">setOutRequestNo</span><span class="token punctuation">(</span>refundQueryParam<span class="token punctuation">.</span><span class="token function">getOutRequestNo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        model<span class="token punctuation">.</span><span class="token function">setQueryOptions</span><span class="token punctuation">(</span>refundQueryParam<span class="token punctuation">.</span><span class="token function">getQueryOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 设置请求参数</span>
        request<span class="token punctuation">.</span><span class="token function">setBizModel</span><span class="token punctuation">(</span>model<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">AlipayTradeFastpayRefundQueryResponse</span> response <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">// 发起请求</span>
            response <span class="token operator">=</span> alipayClient<span class="token punctuation">.</span><span class="token function">certificateExecute</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">AlipayApiException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;退款失败&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 获取请求状态</span>
        <span class="token class-name">String</span> refund_status <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">getRefundStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">.</span><span class="token function">isSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;REFUND_SUCCESS&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>refund_status<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 退款成功</span>
                <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token string">&quot;退款成功&quot;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token comment">// 退款请求未收到或退款失败</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">hasLength</span><span class="token punctuation">(</span>refund_status<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">fail</span><span class="token punctuation">(</span><span class="token string">&quot;退款失败&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">fail</span><span class="token punctuation">(</span><span class="token string">&quot;该退款订单不存在&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">fail</span><span class="token punctuation">(</span><span class="token string">&quot;获取退款结果失败&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br></div></div><h2 id="五、转账接入"><a href="#五、转账接入" class="header-anchor">#</a> 五、转账接入</h2> <p>以下两段内容来自支付宝官方文档：</p> <blockquote><p>产品介绍：</p> <p>支付包提供了转账到支付宝的接口，针对具备开发能力的商家，提供通过 API 接口完成单笔转账的功能。商家只需输入另一个正确的支付宝账号，即可将资金从本企业支付宝账户转账至另一个支付宝账户。  该产品适用行业较广，可用于商家间的货款结算、转账汇款，商家给企业或个人发放佣金等。</p></blockquote> <blockquote><p>使用限制：</p> <p>目前仅支持账户余额渠道付款，且收款用户的支付宝账号需要完成实名认证，部分用户可能因为账户状态无法收款。单笔转账到支付宝账户为<strong>实时到账</strong>且不支持服务商通过第三方应用代商家调用。</p></blockquote> <p>支付宝转账可分为转账到支付宝账户和转账到银行卡。接入这两种转账方式前，先来了解两个转账的辅助接口：<strong>查询支付宝账户资金</strong> 和 <strong>查询转账业务单据</strong>。下面给出的转账流程也涉及到这两个接口</p> <p>下面是转账调用流程：</p> <ol><li>查询当前商户账户的可用余额，同步返回这个可用余额。</li> <li>若返回的可用余额不小于当前转账金额，则发起转账调用。</li> <li>获取转账调用的同步响应结果，确定转账状态。</li> <li>通过转账单据查询接口进一步确定转账状态。</li></ol> <h3 id="_5-1-查询支付宝账户资金"><a href="#_5-1-查询支付宝账户资金" class="header-anchor">#</a> 5.1 查询支付宝账户资金</h3> <p>在执行转账操作之前，需要确保当前商户的账户余额不小于转账金额。</p> <h4 id="_5-1-1-请求参数"><a href="#_5-1-1-请求参数" class="header-anchor">#</a> 5.1.1 请求参数</h4> <table><thead><tr><th>参数</th> <th>是否必选</th> <th>描述</th></tr></thead> <tbody><tr><td>alipay_user_id</td> <td>必选</td> <td>支付宝会员 id</td></tr> <tr><td>account_type</td> <td>特殊可选</td> <td>查询的账号类型和查询余额账户值为 ACCTRANS_ACCOUNT，为必填参数</td></tr></tbody></table> <p>由于这两个参数在系统中一般固定不变，所以将其定义为常量。</p> <h4 id="_5-1-2-响应参数"><a href="#_5-1-2-响应参数" class="header-anchor">#</a> 5.1.2 响应参数</h4> <table><thead><tr><th>参数</th> <th>固定返回</th> <th>描述</th></tr></thead> <tbody><tr><td>available_amount</td> <td>固定</td> <td>账户可用余额，单位元，精确到小数点后两位。</td></tr> <tr><td>freeze_amount</td> <td>不固定</td> <td>当前支付宝账户的实时冻结余额</td></tr></tbody></table> <h4 id="_5-1-2-业务逻辑"><a href="#_5-1-2-业务逻辑" class="header-anchor">#</a> 5.1.2 业务逻辑</h4> <blockquote><p>请求对象：<code>com.alipay.api.request.AlipayFundAccountQueryRequest</code></p> <p>业务对象：<code>com.alipay.api.domain.AlipayFundAccountQueryModel</code></p></blockquote> <p>查询支付宝账户资金的处理逻辑如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AliTransferServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">AliTransferService</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">AlipayClient</span> alipayClient<span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">queryAccount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 创建查询请求</span>
        <span class="token class-name">AlipayFundAccountQueryRequest</span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AlipayFundAccountQueryRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 创建业务对象</span>
        <span class="token class-name">AlipayFundAccountQueryModel</span> model <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AlipayFundAccountQueryModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 设置业务参数</span>
        model<span class="token punctuation">.</span><span class="token function">setAlipayUserId</span><span class="token punctuation">(</span><span class="token class-name">AlipayConstant</span><span class="token punctuation">.</span>pid<span class="token punctuation">)</span><span class="token punctuation">;</span>
        model<span class="token punctuation">.</span><span class="token function">setAccountType</span><span class="token punctuation">(</span><span class="token class-name">AlipayConstant</span><span class="token punctuation">.</span>accountType<span class="token punctuation">)</span><span class="token punctuation">;</span>
        request<span class="token punctuation">.</span><span class="token function">setBizModel</span><span class="token punctuation">(</span>model<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">AlipayFundAccountQueryResponse</span> response<span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">// 发送请求</span>
            response <span class="token operator">=</span> alipayClient<span class="token punctuation">.</span><span class="token function">certificateExecute</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">AlipayApiException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;获取商户账户信息失败&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span><span class="token function">isSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 获取可用余额</span>
            <span class="token class-name">String</span> availableAmount <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">getAvailableAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 获取冻结资金</span>
            <span class="token class-name">String</span> freezeAmount <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">getFreezeAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            result<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;status&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;success&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            result<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;availableAmount&quot;</span><span class="token punctuation">,</span> availableAmount<span class="token punctuation">)</span><span class="token punctuation">;</span>
            result<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;freezeAmount&quot;</span><span class="token punctuation">,</span> freezeAmount<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            result<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;status&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;fail&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br></div></div><h3 id="_5-2-查询转账业务单据"><a href="#_5-2-查询转账业务单据" class="header-anchor">#</a> 5.2 查询转账业务单据</h3> <h4 id="_5-2-1-请求参数"><a href="#_5-2-1-请求参数" class="header-anchor">#</a> 5.2.1 请求参数</h4> <p>查询转账业务单据的参数支付宝转账单据号 <code>order_id</code> 、支付宝支付流水号 <code>pay_fund_order_id</code> 以及商户转账订单号 <code>out_biz_no</code> 三者不能同时为空，至于它们同时存在或两两存在如何取值可参考支付宝官方文档，这里仅仅列出了使用 <code>out_biz_no</code> 时的必传参数。</p> <table><thead><tr><th>参数</th> <th style="text-align:left;">是否必选</th> <th style="text-align:left;">描述</th></tr></thead> <tbody><tr><td>product_code</td> <td style="text-align:left;">必选</td> <td style="text-align:left;">销售产品码，如果使用out_biz_no则该字段必传。可传值如下：<br>TRANS_ACCOUNT_NO_PWD：单笔无密转账到支付宝账户<br>TRANS_BANKCARD_NO_PWD：单笔无密转账到银行卡</td></tr> <tr><td>biz_scene</td> <td style="text-align:left;">必选</td> <td style="text-align:left;">业务场景，如果传递了out_biz_no则该字段必传。单笔无密转账固定为DIRECT_TRANSFER</td></tr> <tr><td>out_biz_no</td> <td style="text-align:left;">必选</td> <td style="text-align:left;">转账订单号</td></tr></tbody></table> <p>这里仅仅处理单笔无密转账的业务场景，可将 <code>biz_scene</code> 定义为常量，将其它请求参数定位 Bean，代码如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TransferQueryParam</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> outBizNo<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> productCode<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="_5-2-2-响应参数"><a href="#_5-2-2-响应参数" class="header-anchor">#</a> 5.2.2 响应参数</h4> <p>这里仅仅介绍了包括确定转账状态在内的部分响应参数，更多的响应参数说明可参考支付宝官方文档。</p> <table><thead><tr><th>参数</th> <th>是否固定</th> <th>描述</th></tr></thead> <tbody><tr><td>order_id</td> <td>不固定</td> <td>查询失败不返回</td></tr> <tr><td>pay_fund_order_id</td> <td>不固定</td> <td>转账失败不返回</td></tr> <tr><td>out_biz_no</td> <td>固定</td> <td>商户订单号</td></tr> <tr><td>trans_amount</td> <td>不固定</td> <td>付款成功后的支付金额，订单状态为SUCCESS才返回，其他状态不返回</td></tr> <tr><td>status</td> <td>固定</td> <td>转账单据状态，涉及 alipay.fund.trans.uni.transfer 接口的状态为：<br>SUCCESS：转账成功<br>FAIL：单笔转账到银行卡失败<br>DEALING：单笔转账到银行卡处理中<br>REFUND：单笔转账到银行卡退票</td></tr></tbody></table> <h4 id="_5-2-3-业务逻辑"><a href="#_5-2-3-业务逻辑" class="header-anchor">#</a> 5.2.3 业务逻辑</h4> <blockquote><p>请求对象：<code>com.alipay.api.request.AlipayFundTransCommonQueryRequest</code></p> <p>业务对象：<code>com.alipay.api.domain.AlipayFundTransCommonQueryModel</code></p></blockquote> <p>查询转账业务单据的处理逻辑代码如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AliTransferServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">AliTransferService</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">AlipayClient</span> alipayClient<span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Result</span> <span class="token function">queryTransfer</span><span class="token punctuation">(</span><span class="token class-name">TransferQueryParam</span> queryParam<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 创建请求参数</span>
        <span class="token class-name">AlipayFundTransCommonQueryRequest</span> request <span class="token operator">=</span> 
            <span class="token keyword">new</span> <span class="token class-name">AlipayFundTransCommonQueryRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 创建业务对象</span>
        <span class="token class-name">AlipayFundTransCommonQueryModel</span> model <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AlipayFundTransCommonQueryModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 设置业务参数</span>
        model<span class="token punctuation">.</span><span class="token function">setOutBizNo</span><span class="token punctuation">(</span>queryParam<span class="token punctuation">.</span><span class="token function">getOutBizNo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        model<span class="token punctuation">.</span><span class="token function">setProductCode</span><span class="token punctuation">(</span>queryParam<span class="token punctuation">.</span><span class="token function">getProductCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        request<span class="token punctuation">.</span><span class="token function">setBizModel</span><span class="token punctuation">(</span>model<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">AlipayFundTransCommonQueryResponse</span> response <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">// 发送请求</span>
            response <span class="token operator">=</span> alipayClient<span class="token punctuation">.</span><span class="token function">certificateExecute</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">AlipayApiException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;获取转账状态失败&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">.</span><span class="token function">isSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">String</span> status <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">&quot;SUCCESS&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>status<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token string">&quot;转账成功&quot;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;REFUND&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>status<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token string">&quot;银行卡转账退票&quot;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;FAIL&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>status<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token string">&quot;转账到银行卡失败&quot;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;DEALING&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>status<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token string">&quot;处理中&quot;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">fail</span><span class="token punctuation">(</span><span class="token string">&quot;获取转账状态失败&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br></div></div><h3 id="_5-3-转账"><a href="#_5-3-转账" class="header-anchor">#</a> 5.3 转账</h3> <p>转账到支付宝账户和转账到银行卡的接口都是：<code>alipay.fund.trans.uni.transfer</code> ，此接口会同步返回转账状态。</p> <h4 id="_5-3-1-请求参数"><a href="#_5-3-1-请求参数" class="header-anchor">#</a> 5.3.1 请求参数</h4> <table><thead><tr><th>参数</th> <th>是否必选</th> <th>描述</th></tr></thead> <tbody><tr><td>out_biz_no</td> <td>必选</td> <td>商家侧定义的订单号，需要保证唯一</td></tr> <tr><td>trans_amount</td> <td>必选</td> <td>转账金额，取值范围[0.1,100000000]</td></tr> <tr><td>product_code</td> <td>必选</td> <td>销售产品码。可选值为：<br>单笔无密转账固定为：TRANS_ACCOUNT_NO_PWD<br>单笔无密转账到银行卡固定为：TRANS_BANKCARD_NO_PWD</td></tr> <tr><td>payee_info</td> <td>必选</td> <td>收款方信息</td></tr> <tr><td>biz_scene</td> <td>可选</td> <td>业务场景。单笔无密转账固定为 DIRECT_TRANSFER</td></tr> <tr><td>order_title</td> <td>可选</td> <td>转账业务的标题，用于在支付宝用户的账单里显示</td></tr> <tr><td>remark</td> <td>可选</td> <td>业务备注</td></tr></tbody></table> <p>收款方信息是一个对象，其属性为：</p> <table><thead><tr><th>参数</th> <th>是否必选</th> <th>描述</th></tr></thead> <tbody><tr><td>identity</td> <td>必选</td> <td>收款账号，分为如下几种情况：<br>转账到银行卡，该值为银行卡号<br>当identity_type=ALIPAY_USER_ID 时，该值为支付宝用户UID<br>当identity_type=ALIPAY_LOGON_ID 时，该值填写支付宝登录号。</td></tr> <tr><td>identity_type</td> <td>必选</td> <td>转账账号类型，分为如下几种情况：<br>单笔无密转账到银行卡固定为：BANKCARD_ACCOUNT<br>单笔无密转账到支付宝用户 UID 固定为：ALIPAY_USER_ID<br>单笔无密转账到支付宝登录号固定为：ALIPAY_LOGON_ID</td></tr> <tr><td>name</td> <td>可选</td> <td>当 identity_type=ALIPAY_LOGON_ID 时，本字段必填。</td></tr></tbody></table> <p>其中的业务场景 <code>biz_scene</code> 和查询支付包账户资金以及查询转账业务单据均固定为：<code>DIRECT_TRANSFER</code>，其余的参数可将其定义为 Bean 代码如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TransferParam</span> <span class="token punctuation">{</span>

    <span class="token comment">// 订单号</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> outBizNo<span class="token punctuation">;</span>

    <span class="token comment">// 转账金额</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> transAmount<span class="token punctuation">;</span>

    <span class="token comment">// 产品码</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> productCode<span class="token punctuation">;</span>

    <span class="token comment">// 订单标题</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> orderTitle<span class="token punctuation">;</span>

    <span class="token comment">// 账号</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> identity<span class="token punctuation">;</span>

    <span class="token comment">// 账号类型</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> identityType<span class="token punctuation">;</span>
    
    <span class="token comment">// 收款用户名</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>

    <span class="token comment">// 转账备注 可选参数</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> remark<span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><h4 id="_5-3-2-响应参数"><a href="#_5-3-2-响应参数" class="header-anchor">#</a> 5.3.2 响应参数</h4> <table><thead><tr><th>参数</th> <th>是否固定</th> <th>描述</th></tr></thead> <tbody><tr><td>out_biz_no</td> <td>固定</td> <td>商户订单号</td></tr> <tr><td>order_id</td> <td>固定</td> <td>支付宝转账订单号</td></tr> <tr><td>pay_fund_order_id</td> <td>不固定</td> <td>支付宝支付资金流水号</td></tr> <tr><td>status</td> <td>固定</td> <td>转账单据状态，可选值为：<br>SUCCESS：转账成功<br>REFUND：转账银行卡退票<br>FAIL：失败<br>DEALING：转账到银行卡处理中</td></tr></tbody></table> <h4 id="_5-3-3-业务逻辑"><a href="#_5-3-3-业务逻辑" class="header-anchor">#</a> 5.3.3 业务逻辑</h4> <blockquote><p>请求对象：<code>com.alipay.api.request.AlipayFundAccountQueryRequest</code></p> <p>业务对象：<code>com.alipay.api.domain.AlipayFundAccountQueryModel</code></p></blockquote> <p>转账的业务逻辑代码如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AliTransferServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">AliTransferService</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">AlipayClient</span> alipayClient<span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Result</span> <span class="token function">transfer</span><span class="token punctuation">(</span><span class="token class-name">TransferParam</span> transferParam<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 查询商户账户余额</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> accountMap <span class="token operator">=</span> <span class="token function">queryAccount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 获取查询状态</span>
        <span class="token class-name">String</span> status <span class="token operator">=</span> accountMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;status&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;fail&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>status<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">fail</span><span class="token punctuation">(</span><span class="token string">&quot;查询商户账户余额失败&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 获取商户余额</span>
        <span class="token class-name">String</span> availableAmount <span class="token operator">=</span> accountMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;availableAmount&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 比较商户余额和转账资金</span>
        <span class="token keyword">double</span> v <span class="token operator">=</span> <span class="token class-name">Double</span><span class="token punctuation">.</span><span class="token function">parseDouble</span><span class="token punctuation">(</span>availableAmount<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">double</span> v1 <span class="token operator">=</span> <span class="token class-name">Double</span><span class="token punctuation">.</span><span class="token function">parseDouble</span><span class="token punctuation">(</span>transferParam<span class="token punctuation">.</span><span class="token function">getTransAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>v <span class="token operator">&lt;</span> v1<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">fail</span><span class="token punctuation">(</span><span class="token string">&quot;商户账号余额不足，无法转账&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 创建转账请求</span>
        <span class="token class-name">AlipayFundTransUniTransferRequest</span> request <span class="token operator">=</span> 
            <span class="token keyword">new</span> <span class="token class-name">AlipayFundTransUniTransferRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 创建转账业务对象</span>
        <span class="token class-name">AlipayFundTransUniTransferModel</span> model <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AlipayFundTransUniTransferModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 设置转账业务参数</span>
        model<span class="token punctuation">.</span><span class="token function">setOutBizNo</span><span class="token punctuation">(</span>transferParam<span class="token punctuation">.</span><span class="token function">getOutBizNo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        model<span class="token punctuation">.</span><span class="token function">setTransAmount</span><span class="token punctuation">(</span>transferParam<span class="token punctuation">.</span><span class="token function">getTransAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        model<span class="token punctuation">.</span><span class="token function">setOrderTitle</span><span class="token punctuation">(</span>transferParam<span class="token punctuation">.</span><span class="token function">getOrderTitle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        model<span class="token punctuation">.</span><span class="token function">setRemark</span><span class="token punctuation">(</span>transferParam<span class="token punctuation">.</span><span class="token function">getRemark</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        model<span class="token punctuation">.</span><span class="token function">setProductCode</span><span class="token punctuation">(</span>transferParam<span class="token punctuation">.</span><span class="token function">getProductCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        model<span class="token punctuation">.</span><span class="token function">setBizScene</span><span class="token punctuation">(</span><span class="token class-name">AlipayConstant</span><span class="token punctuation">.</span>singleTransferBizScene<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 设置收款人信息</span>
        <span class="token class-name">Participant</span> payeeInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Participant</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        payeeInfo<span class="token punctuation">.</span><span class="token function">setIdentity</span><span class="token punctuation">(</span>transferParam<span class="token punctuation">.</span><span class="token function">getIdentity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        payeeInfo<span class="token punctuation">.</span><span class="token function">setIdentityType</span><span class="token punctuation">(</span>transferParam<span class="token punctuation">.</span><span class="token function">getIdentityType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">hasLength</span><span class="token punctuation">(</span>transferParam<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            payeeInfo<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span>transferParam<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        model<span class="token punctuation">.</span><span class="token function">setPayeeInfo</span><span class="token punctuation">(</span>payeeInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">hasLength</span><span class="token punctuation">(</span>transferParam<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            payeeInfo<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span>transferParam<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        request<span class="token punctuation">.</span><span class="token function">setBizModel</span><span class="token punctuation">(</span>model<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">AlipayFundTransUniTransferResponse</span> response <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">// 发送请求</span>
            response <span class="token operator">=</span> alipayClient<span class="token punctuation">.</span><span class="token function">certificateExecute</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">AlipayApiException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;转账异常&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">.</span><span class="token function">isSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">String</span> responseStatus <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;SUCCESS&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>responseStatus<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 转账成功</span>
                <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token string">&quot;转账成功&quot;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token comment">// 业务单据查询接口，进一步确定转账状态</span>
                <span class="token class-name">TransferQueryParam</span> queryParam <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TransferQueryParam</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">BeanUtils</span><span class="token punctuation">.</span><span class="token function">copyProperties</span><span class="token punctuation">(</span>transferParam<span class="token punctuation">,</span> queryParam<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token function">queryTransfer</span><span class="token punctuation">(</span>queryParam<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">fail</span><span class="token punctuation">(</span><span class="token string">&quot;转账失败&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br></div></div><h2 id="六、下载对账单"><a href="#六、下载对账单" class="header-anchor">#</a> 六、下载对账单</h2> <p>为方便商户快速查账，支付宝提供了对账单下载地址接口。</p> <h3 id="_6-1-请求参数"><a href="#_6-1-请求参数" class="header-anchor">#</a> 6.1 请求参数</h3> <table><thead><tr><th>参数</th> <th>是否必选</th> <th>描述</th></tr></thead> <tbody><tr><td>bill_type</td> <td>必选</td> <td>账单类型</td></tr> <tr><td>bill_date</td> <td>必选</td> <td>账单时间：日账单格式为 yyyy-MM-dd，月账单格式为 yyyy-MM</td></tr> <tr><td>smid</td> <td>可选</td> <td>二级商户smid，这个参数只在 bill_type 是 trade_zft_merchant 时才能使用</td></tr></tbody></table> <p>商户通过接口或开放平台授权后可获取账单类型 <code>bill_type</code> 的可选值为：</p> <p><code>trade</code>：商户基于支付宝交易收单的业务账单；</p> <p><code>signcustomer</code>：基于商户支付宝余额收入及支出等资金变动的账务账单；</p> <p><code>merchant_act</code>：营销活动账单，包含营销活动的发放，核销记录；</p> <p><code>trade_zft_merchant</code>：直付通二级商户查询交易的业务账单；</p> <p><code>zft_acc</code>：直付通平台商查询二级商户流水使用，返回所有二级商户流水；</p> <p>由此构造的请求参数实体为：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BillQueryParam</span> <span class="token punctuation">{</span>

    <span class="token comment">// 账单类型</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> billType<span class="token punctuation">;</span>

    <span class="token comment">// 账单时间</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> billDate<span class="token punctuation">;</span>

    <span class="token comment">// 二级商户smid</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> smid<span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="_6-2-业务逻辑"><a href="#_6-2-业务逻辑" class="header-anchor">#</a> 6.2 业务逻辑</h3> <blockquote><p>请求对象：<code>com.alipay.api.request.AlipayDataDataserviceBillDownloadurlQueryRequest</code></p> <p>业务对象：<code>com.alipay.api.domain.AlipayDataDataserviceBillDownloadurlQueryModel</code></p></blockquote> <p>查询对账单下载地址的业务逻辑代码如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Service</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AlipayServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">AlipayService</span> <span class="token punctuation">{</span>
    
    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">AlipayClient</span> alipayClient<span class="token punctuation">;</span>
    
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">queryBill</span><span class="token punctuation">(</span><span class="token class-name">BillQueryParam</span> queryParam<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 创建请求对象</span>
        <span class="token class-name">AlipayDataDataserviceBillDownloadurlQueryRequest</span> request <span class="token operator">=</span>
                <span class="token keyword">new</span> <span class="token class-name">AlipayDataDataserviceBillDownloadurlQueryRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 创建业务对象</span>
        <span class="token class-name">AlipayDataDataserviceBillDownloadurlQueryModel</span> model <span class="token operator">=</span>
                <span class="token keyword">new</span> <span class="token class-name">AlipayDataDataserviceBillDownloadurlQueryModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 设置业务参数</span>
        model<span class="token punctuation">.</span><span class="token function">setBillType</span><span class="token punctuation">(</span>queryParam<span class="token punctuation">.</span><span class="token function">getBillType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        model<span class="token punctuation">.</span><span class="token function">setBillDate</span><span class="token punctuation">(</span>queryParam<span class="token punctuation">.</span><span class="token function">getBillDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">hasLength</span><span class="token punctuation">(</span>queryParam<span class="token punctuation">.</span><span class="token function">getSmid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            model<span class="token punctuation">.</span><span class="token function">setSmid</span><span class="token punctuation">(</span>queryParam<span class="token punctuation">.</span><span class="token function">getSmid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        request<span class="token punctuation">.</span><span class="token function">setBizModel</span><span class="token punctuation">(</span>model<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> downloadUrl <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token class-name">AlipayDataDataserviceBillDownloadurlQueryResponse</span> response<span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">// 发送请求</span>
            response <span class="token operator">=</span> alipayClient<span class="token punctuation">.</span><span class="token function">certificateExecute</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">AlipayApiException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;获取对账单下载地址异常&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">.</span><span class="token function">isSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 获取对账单下载地址</span>
            downloadUrl <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">getBillDownloadUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> downloadUrl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br></div></div></div></div>  <div class="page-edit"><!----> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2023/06/10, 04:55:47</span></div></div> <div class="page-nav-wapper"><!----> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/180eb2/" class="prev">SpringBoot动态定时任务</a></span> <span class="next"><a href="/pages/58a1d3/">微服务与SpringCloud</a>→
      </span></p></div></div></div> <!----></main></div> <div class="footer"><div class="icons"><a href="mailto:2772540969@qq.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/mengyahui" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://music.163.com" title="听音乐" target="_blank" class="iconfont icon-erji"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2022-2023
    <span>MYH | <a href="https://github.com/mengyahui/blob/main/LICENSE" target="_blank">MIT License</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.67223bcb.js" defer></script><script src="/assets/js/2.316bc55b.js" defer></script><script src="/assets/js/41.13dd3c48.js" defer></script>
  </body>
</html>
